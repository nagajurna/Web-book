"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),WebBook=function(){function t(e,i){var n=this;_classCallCheck(this,t),this._bookContainer=e,this._textContainer=e.querySelector("[data-wb-text-container]"),this._text=e.querySelector("[data-wb-text]"),this._height=i.height,this._width=i.maxWidth,this._marginX=void 0===i.marginX?35:i.marginX,this._marginY=void 0===i.marginY?20:i.marginY,this._position=0,this.col=!0,this._bookmark=null,this._containerWidth=null,this._lastBreak=document.createElement("div"),this._lastBreak.className="wb-text-break",this._text.appendChild(this._lastBreak),this._lastElement=document.createElement("div"),this._lastElement.innerHTML="&nbsp;",this._lastElement.className="wb-section wb-no-toc",this._text.appendChild(this._lastElement),this._sections=this._text.querySelectorAll(".wb-section"),this._breaks=this._text.querySelectorAll(".wb-text-break"),this._elements=this._text.querySelectorAll(":not(.wb-text-break)"),this._toc=this._bookContainer.querySelector("[data-wb-toc]"),this.getToc(),this._currentPages=this._bookContainer.querySelectorAll(".wb-current-page"),this._totalPages=this._bookContainer.querySelectorAll(".wb-total-pages"),this._currentTotalPages=this._bookContainer.querySelectorAll(".wb-currentByTotal-pages"),this._elPageNumbers=this._bookContainer.querySelectorAll("[data-wb-element-page-number]"),this._sectionTitles=this._bookContainer.querySelectorAll(".wb-current-section-title"),this._startPage=null,this._endPage=null,this._bookContainer.querySelectorAll(".wb-link").forEach(function(t){t.addEventListener("click",function(t){if(!0===n.col){t.preventDefault();var e=t.target.getAttribute("href").replace(/^#/,"");n.goToPage(n.elementPageNumber(e))}},!1)}),("WebkitColumnWidth"in document.body.style||"MozColumnWidth"in document.body.style||"columnWidth"in document.body.style)&&this.toBook()}return _createClass(t,[{key:"toBook",value:function(){if("WebkitColumnWidth"in document.body.style||"MozColumnWidth"in document.body.style||"columnWidth"in document.body.style){this.col=!0;var t=this._textContainer.style,e=this._text.style;t.boxSizing="border-box",t.overflow="hidden",t.position="relative",t.left=0,t.top=0,t.padding="0px",t.height=this.getHeight()+"px",t.maxWidth=this.getWidth()+"px",this._containerWidth=this._textContainer.clientWidth;for(var i=0;i<this._sections.length;i++)"10%"!==this._sections[i].style.minHeight&&(this._sections[i].style.minHeight="10%");for(var n=0;n<this._breaks.length;n++)"300%"!==this._breaks[n].style.marginBottom&&(this._breaks[n].style.marginBottom="300%");"300%"!==this._lastElement.style.marginBottom&&(this._lastElement.style.marginBottom="300%"),e.boxSizing="border-box",e.position="absolute",e.left=0,e.top=0,e.height="100%",e.width="100%",e.paddingRight=this.getMarginX()+"px",e.paddingLeft=this.getMarginX()+"px",e.paddingTop=this.getMarginY()+"px",e.paddingBottom=this.getMarginY()+"px",e.MozColumnFill="auto",e.WebkitColumnsWidth=this._containerWidth+"px",e.MozColumnWidth=this._containerWidth+"px",e.columnWidth=this._containerWidth+"px",e.MozColumnGap=2*this.getMarginX()+"px",e.WebkitColumnGap=2*this.getMarginX()+"px",e.columnGap=2*this.getMarginX()+"px",this._bookmark&&(this.goToBookmark(this._bookmark),this._position=this._text.offsetLeft),this.refresh()}}},{key:"toScroll",value:function(){this.col=!1;var t=this._container.style,e=this._text.style;t.height="auto",t.maxWidth=this.getWidth()+"px",t.overflow="visible",e.position="static",e.height="auto",t.paddingRight=this.getMarginX()+"px",t.paddingLeft=this.getMarginX()+"px",t.paddingTop=this.getMarginY()+"px",t.paddingBottom=this.getMarginY()+"px",("WebkitColumnWidth"in document.body.style||"MozColumnWidth"in document.body.style||"columnWidth"in document.body.style)&&(e.WebkitColumns="auto 1",e.MozColumns="auto 1",e.columns="auto 1");for(var i=0;i<this._sections.length;i++)this._sections[i].style.minHeight="0";for(var n=0;n<this._breaks.length;n++)this._breaks[n].style.marginBottom="0";this._lastElement.style.marginBottom="0px",this.refresh()}},{key:"setWidth",value:function(t){return this._width=t,this}},{key:"getWidth",value:function(){return this._width}},{key:"setHeight",value:function(t){return this._height=t,this}},{key:"getHeight",value:function(){return this._height}},{key:"setMarginX",value:function(t){return this._marginX=t,this}},{key:"getMarginX",value:function(){return this._marginX}},{key:"setMarginY",value:function(t){return this._marginY=t,this}},{key:"getMarginY",value:function(){return this._marginY}},{key:"forward",value:function(){this._lastElement.offsetLeft+this._position>this._containerWidth+this.getMarginX()&&(this._position=this._text.offsetLeft,this._position-=this._containerWidth,this._text.style.left=this._position+"px",this.refresh())}},{key:"backward",value:function(){this._position<0&&(this._position=this._text.offsetLeft,this._position+=this._containerWidth,this._text.style.left=this._position+"px",this.refresh())}},{key:"tofirstPage",value:function(){this._position<0&&(this._position=0,this._text.style.left=this._position+"px",this.refresh())}},{key:"tolastPage",value:function(){this._lastElement.offsetLeft+this._position>this._containerWidth+this.getMarginX()&&(this._position=this._containerWidth+this.getMarginX()-this._lastElement.offsetLeft,this._text.style.left=this._position+"px",this.refresh())}},{key:"getPageScope",value:function(){for(var t=void 0,e=void 0,i=void 0,n=0;n<this._sections.length-1;n++)if(this._sections[n].className.match(/wb-no-page/)){if(void 0!==e){i=n;var s=this._sections[i].offsetLeft-this.getMarginX();s=s%this._containerWidth!=0?s-s%this._containerWidth:s,this._endPage=s/this._containerWidth+1,console.log(this._endPage);break}t=n}else if(void 0!==t&&void 0===e){e=n;var o=this._sections[e].offsetLeft-this.getMarginX();o=o%this._containerWidth!=0?o-o%this._containerWidth:o,this._startPage=o/this._containerWidth,console.log(this._startPage)}}},{key:"getPageNumber",value:function(){var t=Math.abs(Math.floor(this._position/this._containerWidth))+1;return t-=this._startPage}},{key:"getTotalPages",value:function(){var t=Math.floor(this._lastElement.offsetLeft/this._containerWidth);return t-=this._startPage}},{key:"goToPage",value:function(t){t=(t=t<1-this._startPage?1-this._startPage:t)>this.getTotalPages()?this.getTotalPages():t,t+=this._startPage;var e=this._containerWidth*(t-1);this._text.style.left=-e+"px",this._position=this._text.offsetLeft,this.refresh()}},{key:"elementPageNumber",value:function(t){var e=this._text.querySelector("#"+t).offsetLeft-this.getMarginX(),i=(e=e%this._containerWidth!=0?e-e%this._containerWidth:e)/this._containerWidth+1;return i-=this._startPage}},{key:"getSectionTitle",value:function(){for(var t=-this._position,e=void 0,i=1;i<this._sections.length;i++)if(this._sections[i].offsetLeft-this._containerWidth>=t){var n=this._sections[i-1].id;e=void 0!==n&&this.getPageNumber()===this.elementPageNumber(n)?"":this._sections[i-1].getAttribute("data-wb-title");break}return e}},{key:"getToc",value:function(){var t=this;if(this._toc){if(this._toc.getAttribute("data-wb-toc")){var e=document.createElement("p");e.setAttribute("class","wb-toc-title"),e.innerHTML=this._toc.getAttribute("data-wb-toc"),this._toc.appendChild(e)}this._sections.forEach(function(e){if(!e.className.match(/wb-no-toc/)){var i=document.createElement("p");i.innerHTML=e.getAttribute("data-wb-title"),i.setAttribute("class","wb-toc-item");var n=document.createElement("a");n.setAttribute("href","#"+e.id),n.setAttribute("class","wb-link"),n.setAttribute("data-wb-element-page-number",e.id),i.appendChild(n),t._toc.appendChild(i)}})}}},{key:"getTocCurrentSection",value:function(){for(var t=this,e=-this._position,i=1;i<this._sections.length&&!(this._sections[i].offsetLeft-this._containerWidth>=e&&"break"===function(){var e=t._sections[i-1].id;return t._toc.querySelectorAll("a").forEach(function(t){t.getAttribute("href").replace(/^#/,"")===e?t.parentElement.className.match(/current/)||(t.parentElement.className+=" current"):t.parentElement.className.match(/current/)&&(t.parentElement.className=t.parentElement.className.replace(/ current/,""))}),"break"}());i++);}},{key:"insertBookmark",value:function(){for(var t=null,e=0;e<this._elements.length;e++){var i=this._elements[e].offsetLeft-this.getMarginX();if((i=i%this._containerWidth!=0?i-i%this._containerWidth:i)===-this._position){t=e;break}if(i>-this._position){t=e-1;break}}this._bookmark=t}},{key:"goToBookmark",value:function(t){var e=this._elements[this._bookmark].offsetLeft-this.getMarginX();e=e%this._containerWidth!=0?e-e%this._containerWidth:e,this._text.style.left=-e+"px",this._position=this._text.offsetLeft,this.refresh()}},{key:"refresh",value:function(){var t=this;this.insertBookmark(),!1===this.col?(this._currentPages.forEach(function(t){t.innerHTML=""}),this._totalPages.forEach(function(t){t.innerHTML=""}),this._currentTotalPages.forEach(function(t){t.innerHTML=""}),this._elPageNumbers.forEach(function(t){t.innerHTML=""}),this._sectionTitles.forEach(function(t){t.innerHTML=""})):(this.getPageScope(),this._toc&&this.getTocCurrentSection(),this._currentPages.forEach(function(e){e.innerHTML!=t.getPageNumber()&&(e.innerHTML=t.getPageNumber())}),this._totalPages.forEach(function(e){e.innerHTML!=t.getTotalPages()&&(e.innerHTML=t.getTotalPages())}),this._currentTotalPages.forEach(function(e){t.getPageNumber()<1?e.innerHTML="&emsp;&emsp;":e.innerHTML!==t.getPageNumber()+"/"+t.getTotalPages()&&(e.innerHTML=t.getPageNumber()+"/"+t.getTotalPages())}),this._elPageNumbers.forEach(function(e){var i=e.getAttribute("data-wb-element-page-number"),n=t.elementPageNumber(i);n<1?e.innerHTML="":e.innerHTML!=n&&(e.innerHTML=n)}),this._sectionTitles.forEach(function(e){e.innerHTML!==t.getSectionTitle()&&(e.innerHTML=t.getSectionTitle())}))}}]),t}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYi1ib29rLmpzIl0sIm5hbWVzIjpbIldlYkJvb2siLCJib29rQ29udGFpbmVyIiwib3B0aW9ucyIsIl90aGlzIiwidGhpcyIsIl9jbGFzc0NhbGxDaGVjayIsIl9ib29rQ29udGFpbmVyIiwiX3RleHRDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiX3RleHQiLCJfaGVpZ2h0IiwiX3dpZHRoIiwibWF4V2lkdGgiLCJfbWFyZ2luWCIsInVuZGVmaW5lZCIsIm1hcmdpblgiLCJfbWFyZ2luWSIsIm1hcmdpblkiLCJfcG9zaXRpb24iLCJoZWlnaHQiLCJfbGFzdEVsZW1lbnQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJjb2wiLCJjbGFzc05hbWUiLCJfYm9va21hcmsiLCJfc2VjdGlvbnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2xhc3RCcmVhayIsIl9lbGVtZW50cyIsIl90b3RhbFBhZ2VzIiwiX2JyZWFrcyIsIl9lbFBhZ2VOdW1iZXJzIiwiX3RvYyIsIl9lbmRQYWdlIiwiX2N1cnJlbnRQYWdlcyIsInZhbCIsIl9jdXJyZW50VG90YWxQYWdlcyIsImUiLCJpZCIsIl9zZWN0aW9uVGl0bGVzIiwiZ2V0QXR0cmlidXRlIiwicmVwbGFjZSIsIl9zdGFydFBhZ2UiLCJlbGVtZW50UGFnZU51bWJlciIsImJvZHkiLCJzdHlsZSIsInByZXZlbnREZWZhdWx0IiwiY3MiLCJ0cyIsInRvQm9vayIsImJveFNpemluZyIsIm92ZXJmbG93IiwicG9zaXRpb24iLCJsZWZ0IiwidG9wIiwicGFkZGluZyIsImdldEhlaWdodCIsImNsaWVudFdpZHRoIiwiaSIsImxlbmd0aCIsIm1pbkhlaWdodCIsIl9jb250YWluZXJXaWR0aCIsIm1hcmdpbkJvdHRvbSIsIndpZHRoIiwicGFkZGluZ1JpZ2h0IiwicGFkZGluZ0xlZnQiLCJnZXRNYXJnaW5YIiwicGFkZGluZ1RvcCIsImdldE1hcmdpblkiLCJwYWRkaW5nQm90dG9tIiwiTW96Q29sdW1uRmlsbCIsIldlYmtpdENvbHVtbnNXaWR0aCIsIm9mZnNldExlZnQiLCJXZWJraXRDb2x1bW5HYXAiLCJfY29udGFpbmVyIiwiZ2V0V2lkdGgiLCJjb2x1bW5zIiwiV2Via2l0Q29sdW1ucyIsInJlZnJlc2giLCJ3IiwiaCIsIm0iLCJpbmRleCIsImVuZEluZGV4IiwibWF0Y2giLCJzdGFydEluZGV4IiwiZWxQb3NpdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJwYWdlTnVtYmVyIiwiYWJzIiwidG90YWxQYWdlcyIsIk1hdGgiLCJudW1iZXIiLCJlbCIsImVsUGFnZU51bWJlciIsInRpdGxlIiwiZ2V0UGFnZU51bWJlciIsInRvY1RpdGxlIiwic2V0QXR0cmlidXRlIiwicCIsImEiLCJhcHBlbmRDaGlsZCIsIl90aGlzMiIsIl90aGlzMyIsImZvckVhY2giLCJwYXJlbnRFbGVtZW50IiwiYm9va21hcmsiLCJfdGhpczQiLCJnZXRUb2NDdXJyZW50U2VjdGlvbiIsImVsZW1lbnQiLCJnZXRUb3RhbFBhZ2VzIiwiaW5zZXJ0Qm9va21hcmsiLCJnZXRTZWN0aW9uVGl0bGUiXSwibWFwcGluZ3MiOiI2WEFBTUEsbUJBQ0wsU0FBQUEsRUFBWUMsRUFBZUMsR0FBUyxJQUFBQyxFQUFBQyxLQUFBQyxnQkFBQUQsS0FBQUosR0FFbkNJLEtBQUtFLGVBQWlCTCxFQUN0QkcsS0FBS0csZUFBaUJOLEVBQWNPLGNBQWMsNEJBQ2xESixLQUFLSyxNQUFRUixFQUFjTyxjQUFjLGtCQUoxQ0osS0FBQU0sUUFBQVIsRUFBWUQsT0FBd0JHLEtBQUFPLE9BQUFULEVBQUFVLFNBUW5DUixLQUFLUyxjQUE2QkMsSUFBbEJaLEVBQVFhLFFBQXNCLEdBQUtiLEVBQVFhLFFBUnhCWCxLQUFBWSxjQUFBRixJQUFBWixFQUFBZSxRQUFBLEdBQUFmLEVBQUFlLFFBQ25DYixLQUFBYyxVQUFBLEVBQ0FkLEtBQUtFLEtBQUFBLEVBQ0xGLEtBQUtHLFVBQUFBLEtBQ0xILEtBQUtLLGdCQUFRUixLQUViRyxLQUFLTSxXQUFVUixTQUFRaUIsY0FB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LEtBQUFnQyxjQUFBdUUsUUFBQSxTQUFBdEUsR0FDSWlCLEVBQUFBLFdBQVcwRCxFQUFRdEMsa0JBQ3ZCcEIsRUFBQUEsVUFBWUEsRUFBUzZDLG1CQUlyQi9GLEtBQUs0RSxZQUFMMkIsUUFBQSxTQUFBdEUsR0FDQUEsRUFBQWQsV0FBQXVGLEVBQUFHLGtCQTJDRzVFLEVBQUlkLFVBQVl1RixFQUFLRyxtQkFJdkI3RyxLQUFLa0MsbUJBQW1CcUUsUUFBUyxTQUFBdEUsR0E1Q2xDeUUsRUFBS0ksZ0JBQUwsRUE4Q0c3RSxFQUFJZCxVQUFZLGVBNUNYQyxFQUFMRCxZQUFrQnVGLEVBQUFYLGdCQUFBLElBQUFXLEVBQUFHLGtCQThDbEI1RSxFQUFJZCxVQUFZdUYsRUFBS1gsZ0JBQWtCLElBQU1XLEVBQUtHLG1CQUlwRDdHLEtBQUs2QixlQUFlMEUsUUFBUyxTQUFBdEUsR0E1QzdCLElBQUFHLEVBQUtULEVBQUFBLGFBQXFCLCtCQUN6Qk0sRUFBZ0J5RSxFQUFoQmpFLGtCQUFBTCxHQUREbUQsRUFBQSxFQWdERXRELEVBQUlkLFVBQVksR0E1Q2JlLEVBQUFBLFdBQW1CcUUsSUFDdkJ0RSxFQUFJZCxVQUFZb0UsS0FJaEJ0RCxLQUFBQSxlQUFBc0UsUUFBQSxTQUFBdEUsR0FEREEsRUFBQWQsWUFBQXVGLEVBQUFLLG9CQWdERTlFLEVBQUlkLFVBQVl1RixFQUFLSyIsImZpbGUiOiJ3ZWItYm9vay5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBXZWJCb29rIHtcblx0Y29uc3RydWN0b3IoYm9va0NvbnRhaW5lciwgb3B0aW9ucykge1xuXHRcdC8vY29udGFpbmVyc1xuXHRcdHRoaXMuX2Jvb2tDb250YWluZXIgPSBib29rQ29udGFpbmVyO1xuXHRcdHRoaXMuX3RleHRDb250YWluZXIgPSBib29rQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXdiLXRleHQtY29udGFpbmVyXScpO1xuXHRcdHRoaXMuX3RleHQgPSBib29rQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXdiLXRleHRdJyk7XG5cdFx0Ly9vcHRpb25zXG5cdFx0dGhpcy5faGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG5cdFx0dGhpcy5fd2lkdGggPSBvcHRpb25zLm1heFdpZHRoO1xuXHRcdHRoaXMuX21hcmdpblggPSBvcHRpb25zLm1hcmdpblg9PT11bmRlZmluZWQgPyAzNSA6IG9wdGlvbnMubWFyZ2luWDtcblx0XHR0aGlzLl9tYXJnaW5ZID0gb3B0aW9ucy5tYXJnaW5ZPT09dW5kZWZpbmVkID8gMjAgOiBvcHRpb25zLm1hcmdpblk7XG5cdFx0Ly9pbml0IHBvc2l0aW9uLCBjb2wgLGNvbnRhaW5lcldpZHRoIGFuZCBib29rbWFya1xuXHRcdHRoaXMuX3Bvc2l0aW9uID0gMDtcblx0XHR0aGlzLmNvbCA9IHRydWU7Ly9kZWZhdWx0IHRydWUgPSB0b0Jvb2soKVxuXHRcdHRoaXMuX2Jvb2ttYXJrID0gbnVsbDtcblx0XHR0aGlzLl9jb250YWluZXJXaWR0aCA9IG51bGw7XG5cdFx0Ly90aGlzLmxhc3RCcmVhayBpcyB1c2VkIGFzIGEgZ2hvc3QgcGFnZVxuXHRcdHRoaXMuX2xhc3RCcmVhayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0dGhpcy5fbGFzdEJyZWFrLmNsYXNzTmFtZSA9IFwid2ItdGV4dC1icmVha1wiO1xuXHRcdHRoaXMuX3RleHQuYXBwZW5kQ2hpbGQodGhpcy5fbGFzdEJyZWFrKTtcblx0XHQvL3RoaXMuX2xhc3RFbGVtZW50IGlzIHVzZWQgYXMgbGFuZG1hcmtcblx0XHR0aGlzLl9sYXN0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0dGhpcy5fbGFzdEVsZW1lbnQuaW5uZXJIVE1MID0gXCImbmJzcDtcIjsvL25vdCBlbXB0eSAoZm9yIG1vekNvbHVtbnMpXG5cdFx0dGhpcy5fbGFzdEVsZW1lbnQuY2xhc3NOYW1lID0gXCJ3Yi1zZWN0aW9uIHdiLW5vLXRvY1wiO1xuXHRcdHRoaXMuX3RleHQuYXBwZW5kQ2hpbGQodGhpcy5fbGFzdEVsZW1lbnQpO1xuXHRcdC8vc2VjdGlvbnNcblx0XHR0aGlzLl9zZWN0aW9ucyA9IHRoaXMuX3RleHQucXVlcnlTZWxlY3RvckFsbCgnLndiLXNlY3Rpb24nKTtcblx0XHQvL2JyZWFrc1xuXHRcdHRoaXMuX2JyZWFrcyA9IHRoaXMuX3RleHQucXVlcnlTZWxlY3RvckFsbCgnLndiLXRleHQtYnJlYWsnKTtcblx0XHQvL2VsZW1lbnRzIDogc2VsZWN0IGFsbCBlbGVtZW50cyBidXQgLnRleHQtYnJlYWtzIChmb3IgYm9va21hcmtzKVxuXHRcdHRoaXMuX2VsZW1lbnRzID0gdGhpcy5fdGV4dC5xdWVyeVNlbGVjdG9yQWxsKCc6bm90KC53Yi10ZXh0LWJyZWFrKScpO1xuXHRcdC8vdG9jXG5cdFx0dGhpcy5fdG9jID0gdGhpcy5fYm9va0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdbZGF0YS13Yi10b2NdJyk7XG5cdFx0Ly9zZXRUb2MgYmVmb3JlIHF1ZXJ5aW5nIHRoaXMuZWxQYWdlTnVtYmVyc1xuXHRcdHRoaXMuZ2V0VG9jKCk7XG5cdFx0Ly9pbmZvcyBjb250YWluZXJzXG5cdFx0dGhpcy5fY3VycmVudFBhZ2VzID0gdGhpcy5fYm9va0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcud2ItY3VycmVudC1wYWdlJyk7XG5cdFx0dGhpcy5fdG90YWxQYWdlcyA9IHRoaXMuX2Jvb2tDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLndiLXRvdGFsLXBhZ2VzJyk7XG5cdFx0dGhpcy5fY3VycmVudFRvdGFsUGFnZXMgPSB0aGlzLl9ib29rQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy53Yi1jdXJyZW50QnlUb3RhbC1wYWdlcycpO1xuXHRcdHRoaXMuX2VsUGFnZU51bWJlcnMgPSB0aGlzLl9ib29rQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXdiLWVsZW1lbnQtcGFnZS1udW1iZXJdJyk7XG5cdFx0dGhpcy5fc2VjdGlvblRpdGxlcyA9IHRoaXMuX2Jvb2tDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLndiLWN1cnJlbnQtc2VjdGlvbi10aXRsZScpO1xuXHRcdC8vc3RhcnQvZW5kIHBhZ2luYXRpb25cblx0XHR0aGlzLl9zdGFydFBhZ2UgPSBudWxsO1xuXHRcdHRoaXMuX2VuZFBhZ2UgPSBudWxsO1xuXHRcdC8vbGlua3MgOiByZXBsYWNlIGRlZmF1bHQgd2l0aCBnb1RvUGFnZVxuXHRcdGxldCBsaW5rcyA9IHRoaXMuX2Jvb2tDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLndiLWxpbmsnKTtcblx0XHRsaW5rcy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0dmFsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG5cdFx0XHRcdGlmKHRoaXMuY29sPT09dHJ1ZSkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRsZXQgaHJlZiA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpO1xuXHRcdFx0XHRcdGxldCBpZCA9IGhyZWYucmVwbGFjZSgvXiMvLFwiXCIpO1xuXHRcdFx0XHRcdHRoaXMuZ29Ub1BhZ2UodGhpcy5lbGVtZW50UGFnZU51bWJlcihpZCkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCBmYWxzZSk7XG5cdFx0fSlcblx0XHRcblx0XHRcblx0XHRpZignV2Via2l0Q29sdW1uV2lkdGgnIGluIGRvY3VtZW50LmJvZHkuc3R5bGUgfHwgJ01vekNvbHVtbldpZHRoJyBpbiBkb2N1bWVudC5ib2R5LnN0eWxlIHx8ICdjb2x1bW5XaWR0aCcgaW4gZG9jdW1lbnQuYm9keS5zdHlsZSkge1xuXHRcdFx0dGhpcy50b0Jvb2soKTtcblx0XHR9XG5cblx0fVxuXG5cdHRvQm9vaygpIHtcblx0XHRpZignV2Via2l0Q29sdW1uV2lkdGgnIGluIGRvY3VtZW50LmJvZHkuc3R5bGUgfHwgJ01vekNvbHVtbldpZHRoJyBpbiBkb2N1bWVudC5ib2R5LnN0eWxlIHx8ICdjb2x1bW5XaWR0aCcgIGluIGRvY3VtZW50LmJvZHkuc3R5bGUpIHtcblx0XHRcdHRoaXMuY29sID0gdHJ1ZTtcblx0XHRcdGxldCBjcyA9IHRoaXMuX3RleHRDb250YWluZXIuc3R5bGU7XG5cdFx0XHRsZXQgdHMgPSB0aGlzLl90ZXh0LnN0eWxlO1xuXHRcdFx0Ly90ZXh0LWNvbnRhaW5lclxuXHRcdFx0Y3MuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cdFx0XHRjcy5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG5cdFx0XHRjcy5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcblx0XHRcdGNzLmxlZnQgPSAwO1xuXHRcdFx0Y3MudG9wID0gMDtcblx0XHRcdGNzLnBhZGRpbmcgPSBcIjBweFwiO1xuXHRcdFx0Y3MuaGVpZ2h0ID0gdGhpcy5nZXRIZWlnaHQoKSArIFwicHhcIjtcblx0XHRcdGNzLm1heFdpZHRoID0gdGhpcy5nZXRXaWR0aCgpICsgXCJweFwiOy8vbWF4V2lkdGggOiByZXNwb25zaXZlXG5cdFx0XHR0aGlzLl9jb250YWluZXJXaWR0aCA9IHRoaXMuX3RleHRDb250YWluZXIuY2xpZW50V2lkdGg7Ly9yZXNwb25zaXZlXG5cdFx0XHRcblx0XHRcdC8vc2VjdGlvbnNcblx0XHRcdC8vaGFjayBmaXJlZm94IChwb3VyIG9mZnNldExlZnQpIDogbWluSGVpZ2h0ID0gMTAlXG5cdFx0XHRmb3IobGV0IGk9MDsgaTx0aGlzLl9zZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRpZih0aGlzLl9zZWN0aW9uc1tpXS5zdHlsZS5taW5IZWlnaHQhPT1cIjEwJVwiKSB7XG5cdFx0XHRcdFx0dGhpcy5fc2VjdGlvbnNbaV0uc3R5bGUubWluSGVpZ2h0ID0gXCIxMCVcIjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly9tYW51YWwgYnJlYWtzXG5cdFx0XHRmb3IobGV0IGk9MDsgaTx0aGlzLl9icmVha3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYodGhpcy5fYnJlYWtzW2ldLnN0eWxlLm1hcmdpbkJvdHRvbSE9PVwiMzAwJVwiKSB7XG5cdFx0XHRcdFx0dGhpcy5fYnJlYWtzW2ldLnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMzAwJVwiO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHQvL2xhc3QgZWxlbWVudFxuXHRcdFx0aWYodGhpcy5fbGFzdEVsZW1lbnQuc3R5bGUubWFyZ2luQm90dG9tIT09XCIzMDAlXCIpIHtcblx0XHRcdFx0dGhpcy5fbGFzdEVsZW1lbnQuc3R5bGUubWFyZ2luQm90dG9tID0gXCIzMDAlXCI7XG5cdFx0XHR9XG5cblx0XHRcdC8vdGV4dFxuXHRcdFx0dHMuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cdFx0XHR0cy5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcblx0XHRcdHRzLmxlZnQgPSAwO1xuXHRcdFx0dHMudG9wID0gMDtcblx0XHRcdHRzLmhlaWdodCA9IFwiMTAwJVwiO1xuXHRcdFx0dHMud2lkdGggPSBcIjEwMCVcIjtcblx0XHRcdHRzLnBhZGRpbmdSaWdodCA9IHRoaXMuZ2V0TWFyZ2luWCgpICsgXCJweFwiO1xuXHRcdFx0dHMucGFkZGluZ0xlZnQgPSB0aGlzLmdldE1hcmdpblgoKSArIFwicHhcIjtcblx0XHRcdHRzLnBhZGRpbmdUb3AgPSB0aGlzLmdldE1hcmdpblkoKSArIFwicHhcIjtcblx0XHRcdHRzLnBhZGRpbmdCb3R0b20gPSB0aGlzLmdldE1hcmdpblkoKSArIFwicHhcIjtcblx0XHRcdHRzLk1vekNvbHVtbkZpbGwgPSBcImF1dG9cIjsvL2ltcG9ydGFudCAhISFcblx0XHRcdHRzLldlYmtpdENvbHVtbnNXaWR0aCA9IHRoaXMuX2NvbnRhaW5lcldpZHRoICsgXCJweFwiO1xuXHRcdFx0dHMuTW96Q29sdW1uV2lkdGggPSB0aGlzLl9jb250YWluZXJXaWR0aCArIFwicHhcIjtcblx0XHRcdHRzLmNvbHVtbldpZHRoID0gdGhpcy5fY29udGFpbmVyV2lkdGggKyBcInB4XCI7XG5cdFx0XHR0cy5Nb3pDb2x1bW5HYXAgPSB0aGlzLmdldE1hcmdpblgoKSoyICsgXCJweFwiO1xuXHRcdFx0dHMuV2Via2l0Q29sdW1uR2FwID0gdGhpcy5nZXRNYXJnaW5YKCkqMiArIFwicHhcIjtcblx0XHRcdHRzLmNvbHVtbkdhcCA9IHRoaXMuZ2V0TWFyZ2luWCgpKjIgKyBcInB4XCI7XG5cdFx0XHRcblx0XHRcdC8vR28gdG8gYm9va21hcmtcblx0XHRcdGlmKHRoaXMuX2Jvb2ttYXJrKSB7XG5cdFx0XHRcdHRoaXMuZ29Ub0Jvb2ttYXJrKHRoaXMuX2Jvb2ttYXJrKTtcblx0XHRcdFx0dGhpcy5fcG9zaXRpb24gPSB0aGlzLl90ZXh0Lm9mZnNldExlZnQ7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdC8vUmVmcmVzaCBpbmZvIGNvbnRhaW5lcnNcblx0XHRcdHRoaXMucmVmcmVzaCgpO1xuXHRcdFx0XG5cdFx0fVxuXHR9XG5cblx0dG9TY3JvbGwoKSB7XG5cdFx0J3VzZSBzdHJpY3QnO1xuXHRcdHRoaXMuY29sID0gZmFsc2U7XG5cdFx0bGV0IGNzID0gdGhpcy5fY29udGFpbmVyLnN0eWxlO1xuXHRcdGxldCB0cyA9IHRoaXMuX3RleHQuc3R5bGU7XG5cdFx0Ly9jb250YWluZXJcblx0XHRjcy5oZWlnaHQgPSBcImF1dG9cIjtcblx0XHRjcy5tYXhXaWR0aCA9IHRoaXMuZ2V0V2lkdGgoKSArIFwicHhcIjtcblx0XHRjcy5vdmVyZmxvdyA9IFwidmlzaWJsZVwiO1xuXHRcdC8vdGV4dFxuXHRcdHRzLnBvc2l0aW9uID0gXCJzdGF0aWNcIjtcblx0XHR0cy5oZWlnaHQgPSBcImF1dG9cIjtcblx0XHRjcy5wYWRkaW5nUmlnaHQgPSB0aGlzLmdldE1hcmdpblgoKSArIFwicHhcIjtcblx0XHRjcy5wYWRkaW5nTGVmdCA9IHRoaXMuZ2V0TWFyZ2luWCgpICsgXCJweFwiO1xuXHRcdGNzLnBhZGRpbmdUb3AgPSB0aGlzLmdldE1hcmdpblkoKSArIFwicHhcIjtcblx0XHRjcy5wYWRkaW5nQm90dG9tID0gdGhpcy5nZXRNYXJnaW5ZKCkgKyBcInB4XCI7XG5cblx0XHRpZignV2Via2l0Q29sdW1uV2lkdGgnIGluIGRvY3VtZW50LmJvZHkuc3R5bGUgfHwgJ01vekNvbHVtbldpZHRoJyBpbiBkb2N1bWVudC5ib2R5LnN0eWxlIHx8ICdjb2x1bW5XaWR0aCcgIGluIGRvY3VtZW50LmJvZHkuc3R5bGUpIHtcblx0XHRcdHRzLldlYmtpdENvbHVtbnMgPSBcImF1dG8gMVwiO1xuXHRcdFx0dHMuTW96Q29sdW1ucyA9IFwiYXV0byAxXCI7XG5cdFx0XHR0cy5jb2x1bW5zID0gXCJhdXRvIDFcIjtcblx0XHR9XG5cblx0XHQvL1NlY3Rpb25zIChmb3IgbW96Q29sdW1ucylcblx0XHRmb3IobGV0IGk9MDsgaTx0aGlzLl9zZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuXHRcdFx0dGhpcy5fc2VjdGlvbnNbaV0uc3R5bGUubWluSGVpZ2h0ID0gXCIwXCI7XG5cdFx0fVxuXHRcdC8vbWFudWFsIGJyZWFrc1xuXHRcdGZvcihsZXQgaT0wOyBpPHRoaXMuX2JyZWFrcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0dGhpcy5fYnJlYWtzW2ldLnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMFwiO1xuXHRcdH1cblx0XHQvL2xhc3QgZWxlbWVudFxuXHRcdHRoaXMuX2xhc3RFbGVtZW50LnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMHB4XCI7XG5cblx0XHR0aGlzLnJlZnJlc2goKTtcblx0fTtcblxuXHRzZXRXaWR0aCh3KSB7XG5cdFx0dGhpcy5fd2lkdGggPSB3O1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0Z2V0V2lkdGgoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX3dpZHRoO1xuXHR9XG5cblx0c2V0SGVpZ2h0KGgpIHtcblx0XHR0aGlzLl9oZWlnaHQgPSBoO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0Z2V0SGVpZ2h0KCkge1xuXHRcdHJldHVybiB0aGlzLl9oZWlnaHQ7XG5cdH1cblxuXHRzZXRNYXJnaW5YKG0pIHtcblx0XHR0aGlzLl9tYXJnaW5YID0gbTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdGdldE1hcmdpblgoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX21hcmdpblg7XG5cdH1cblxuXHRzZXRNYXJnaW5ZKG0pIHtcblx0XHR0aGlzLl9tYXJnaW5ZID0gbTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdGdldE1hcmdpblkoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX21hcmdpblk7XG5cdH1cblxuXHRmb3J3YXJkKCkge1xuXHRcdGlmKHRoaXMuX2xhc3RFbGVtZW50Lm9mZnNldExlZnQrdGhpcy5fcG9zaXRpb24gPiB0aGlzLl9jb250YWluZXJXaWR0aCt0aGlzLmdldE1hcmdpblgoKSkge1xuXHRcdFx0Ly9sZXQgY2xvbmUgPSB0aGlzLl90ZXh0LmNsb25lTm9kZSh0cnVlKTtcblx0XHRcdHRoaXMuX3Bvc2l0aW9uID0gdGhpcy5fdGV4dC5vZmZzZXRMZWZ0O1xuXHRcdFx0dGhpcy5fcG9zaXRpb24gLT0gdGhpcy5fY29udGFpbmVyV2lkdGg7XG5cdFx0XHR0aGlzLl90ZXh0LnN0eWxlLmxlZnQgPSB0aGlzLl9wb3NpdGlvbiArIFwicHhcIjtcblx0XHRcdFxuXHRcdFx0Ly9jb25zb2xlLmxvZyhjbG9uZSk7XG5cdFx0XHQvL2Nsb25lLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuXHRcdFx0Ly90aGlzLl9jb250YWluZXIuaW5zZXJ0QmVmb3JlKGNsb25lLHRoaXMudGV4dCk7XG5cdFx0XHR0aGlzLnJlZnJlc2goKTtcblx0XHR9XG5cdH1cblxuXHRiYWNrd2FyZCgpIHtcblx0XHRpZih0aGlzLl9wb3NpdGlvbiA8IDApIHtcblx0XHRcdHRoaXMuX3Bvc2l0aW9uID0gdGhpcy5fdGV4dC5vZmZzZXRMZWZ0O1xuXHRcdFx0dGhpcy5fcG9zaXRpb24gKz0gdGhpcy5fY29udGFpbmVyV2lkdGg7XG5cdFx0XHR0aGlzLl90ZXh0LnN0eWxlLmxlZnQgPSB0aGlzLl9wb3NpdGlvbiArIFwicHhcIjtcblx0XHRcdHRoaXMucmVmcmVzaCgpO1xuXHRcdH1cblx0fVxuXG5cdHRvZmlyc3RQYWdlKCkge1xuXHRcdGlmKHRoaXMuX3Bvc2l0aW9uIDwgMCkge1xuXHRcdFx0dGhpcy5fcG9zaXRpb24gPSAwO1xuXHRcdFx0dGhpcy5fdGV4dC5zdHlsZS5sZWZ0ID0gdGhpcy5fcG9zaXRpb24gKyBcInB4XCI7XG5cdFx0XHR0aGlzLnJlZnJlc2goKTtcblx0XHR9XG5cdH1cblxuXHR0b2xhc3RQYWdlKCkge1xuXHRcdGlmKHRoaXMuX2xhc3RFbGVtZW50Lm9mZnNldExlZnQrdGhpcy5fcG9zaXRpb24gPiB0aGlzLl9jb250YWluZXJXaWR0aCt0aGlzLmdldE1hcmdpblgoKSkge1xuXHRcdFx0dGhpcy5fcG9zaXRpb24gPSB0aGlzLl9jb250YWluZXJXaWR0aCt0aGlzLmdldE1hcmdpblgoKS10aGlzLl9sYXN0RWxlbWVudC5vZmZzZXRMZWZ0O1xuXHRcdFx0dGhpcy5fdGV4dC5zdHlsZS5sZWZ0ID0gdGhpcy5fcG9zaXRpb24rXCJweFwiO1xuXHRcdFx0dGhpcy5yZWZyZXNoKCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRnZXRQYWdlU2NvcGUoKSB7XG5cdFx0bGV0IGluZGV4LCBzdGFydEluZGV4LCBlbmRJbmRleDtcblx0XHRmb3IobGV0IGk9MDsgaTwgdGhpcy5fc2VjdGlvbnMubGVuZ3RoLTE7IGkrKykge1xuXHRcdFx0aWYodGhpcy5fc2VjdGlvbnNbaV0uY2xhc3NOYW1lLm1hdGNoKC93Yi1uby1wYWdlLykpIHtcblx0XHRcdFx0aWYoc3RhcnRJbmRleCE9PXVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdGVuZEluZGV4ID0gaTtcblx0XHRcdFx0XHRsZXQgZWwgPSB0aGlzLl9zZWN0aW9uc1tlbmRJbmRleF07XG5cdFx0XHRcdFx0bGV0IGVsUG9zaXRpb24gPSBlbC5vZmZzZXRMZWZ0IC0gdGhpcy5nZXRNYXJnaW5YKCk7XG5cdFx0XHRcdFx0ZWxQb3NpdGlvbiA9IChlbFBvc2l0aW9uJXRoaXMuX2NvbnRhaW5lcldpZHRoIT09MCA/IGVsUG9zaXRpb24tZWxQb3NpdGlvbiV0aGlzLl9jb250YWluZXJXaWR0aCA6IGVsUG9zaXRpb24pOy8vYWx3YXlzIGF0IGEgcGFnZSBiZWdpbm5pbmdcblx0XHRcdFx0XHR0aGlzLl9lbmRQYWdlID0gZWxQb3NpdGlvbi90aGlzLl9jb250YWluZXJXaWR0aCArIDE7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2codGhpcy5fZW5kUGFnZSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aW5kZXggPSBpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZihpbmRleCE9PXVuZGVmaW5lZCAmJiBzdGFydEluZGV4PT09dW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0c3RhcnRJbmRleCA9IGk7XG5cdFx0XHRcdFx0bGV0IGVsID0gdGhpcy5fc2VjdGlvbnNbc3RhcnRJbmRleF07XG5cdFx0XHRcdFx0bGV0IGVsUG9zaXRpb24gPSBlbC5vZmZzZXRMZWZ0IC0gdGhpcy5nZXRNYXJnaW5YKCk7XG5cdFx0XHRcdFx0ZWxQb3NpdGlvbiA9IChlbFBvc2l0aW9uJXRoaXMuX2NvbnRhaW5lcldpZHRoIT09MCA/IGVsUG9zaXRpb24tZWxQb3NpdGlvbiV0aGlzLl9jb250YWluZXJXaWR0aCA6IGVsUG9zaXRpb24pOy8vYWx3YXlzIGF0IGEgcGFnZSBiZWdpbm5pbmdcblx0XHRcdFx0XHR0aGlzLl9zdGFydFBhZ2UgPSBlbFBvc2l0aW9uL3RoaXMuX2NvbnRhaW5lcldpZHRoO1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKHRoaXMuX3N0YXJ0UGFnZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRnZXRQYWdlTnVtYmVyKCkge1xuXHRcdGxldCBwYWdlTnVtYmVyID0gTWF0aC5hYnMoTWF0aC5mbG9vcih0aGlzLl9wb3NpdGlvbi90aGlzLl9jb250YWluZXJXaWR0aCkpKzE7XG5cdFx0cGFnZU51bWJlciA9IHBhZ2VOdW1iZXItKHRoaXMuX3N0YXJ0UGFnZSk7XG5cdFx0cmV0dXJuIHBhZ2VOdW1iZXI7XG5cdH1cblxuXHRnZXRUb3RhbFBhZ2VzKCkge1xuXHRcdGxldCB0b3RhbFBhZ2VzID0gTWF0aC5mbG9vcih0aGlzLl9sYXN0RWxlbWVudC5vZmZzZXRMZWZ0L3RoaXMuX2NvbnRhaW5lcldpZHRoKTtcblx0XHR0b3RhbFBhZ2VzID0gdG90YWxQYWdlcy0odGhpcy5fc3RhcnRQYWdlKTtcblx0XHRyZXR1cm4gdG90YWxQYWdlcztcblx0fVxuXG5cdGdvVG9QYWdlKG51bWJlcikge1xuXHRcdG51bWJlciA9IChudW1iZXI8MS0odGhpcy5fc3RhcnRQYWdlKSA/IDEtKHRoaXMuX3N0YXJ0UGFnZSkgOiBudW1iZXIpO1xuXHRcdG51bWJlcj0gKG51bWJlcj50aGlzLmdldFRvdGFsUGFnZXMoKSA/IHRoaXMuZ2V0VG90YWxQYWdlcygpIDogbnVtYmVyKTtcblx0XHRudW1iZXIgPSBudW1iZXIgKyAodGhpcy5fc3RhcnRQYWdlKTtcblx0XHRsZXQgcG9zaXRpb24gPSB0aGlzLl9jb250YWluZXJXaWR0aCoobnVtYmVyLTEpO1xuXHRcdHRoaXMuX3RleHQuc3R5bGUubGVmdCA9IC1wb3NpdGlvbiArIFwicHhcIjtcblx0XHR0aGlzLl9wb3NpdGlvbiA9IHRoaXMuX3RleHQub2Zmc2V0TGVmdDtcblx0XHR0aGlzLnJlZnJlc2goKTtcblx0fVxuXG5cdGVsZW1lbnRQYWdlTnVtYmVyKGlkKSB7XG5cdFx0bGV0IGVsID0gdGhpcy5fdGV4dC5xdWVyeVNlbGVjdG9yKCcjJyArIGlkKTtcblx0XHRsZXQgZWxQb3NpdGlvbiA9IGVsLm9mZnNldExlZnQgLSB0aGlzLmdldE1hcmdpblgoKTtcblx0XHRlbFBvc2l0aW9uID0gKGVsUG9zaXRpb24ldGhpcy5fY29udGFpbmVyV2lkdGghPT0wID8gZWxQb3NpdGlvbi1lbFBvc2l0aW9uJXRoaXMuX2NvbnRhaW5lcldpZHRoIDogZWxQb3NpdGlvbik7Ly9hbHdheXMgYXQgYSBwYWdlIGJlZ2lubmluZ1xuXHRcdGxldCBlbFBhZ2VOdW1iZXIgPSBlbFBvc2l0aW9uL3RoaXMuX2NvbnRhaW5lcldpZHRoICsgMTtcblx0XHRlbFBhZ2VOdW1iZXIgPSBlbFBhZ2VOdW1iZXItKHRoaXMuX3N0YXJ0UGFnZSk7XG5cdFx0cmV0dXJuIGVsUGFnZU51bWJlcjtcblx0fVxuXG5cdGdldFNlY3Rpb25UaXRsZSgpIHtcblx0XHRsZXQgcG9zaXRpb24gPSAtdGhpcy5fcG9zaXRpb247XG5cdFx0bGV0IHRpdGxlO1xuXHRcdGZvcihsZXQgaT0xOyBpPHRoaXMuX3NlY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRpZih0aGlzLl9zZWN0aW9uc1tpXS5vZmZzZXRMZWZ0LXRoaXMuX2NvbnRhaW5lcldpZHRoPj1wb3NpdGlvbikge1xuXHRcdFx0XHRsZXQgaWQgPSB0aGlzLl9zZWN0aW9uc1tpLTFdLmlkO1xuXHRcdFx0XHRpZihpZCE9PXVuZGVmaW5lZCAmJiB0aGlzLmdldFBhZ2VOdW1iZXIoKSA9PT0gdGhpcy5lbGVtZW50UGFnZU51bWJlcihpZCkpIHtcblx0XHRcdFx0XHR0aXRsZSA9IFwiXCI7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGl0bGUgPSB0aGlzLl9zZWN0aW9uc1tpLTFdLmdldEF0dHJpYnV0ZSgnZGF0YS13Yi10aXRsZScpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGl0bGU7XG5cdH1cblx0XG5cdGdldFRvYygpIHtcblx0XHRpZighdGhpcy5fdG9jKSB7IHJldHVybjsgfVxuXHRcdGlmKHRoaXMuX3RvYy5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2ItdG9jJykpIHtcblx0XHRcdGxldCB0b2NUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0XHRcdHRvY1RpdGxlLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCd3Yi10b2MtdGl0bGUnKTtcblx0XHRcdHRvY1RpdGxlLmlubmVySFRNTCA9IHRoaXMuX3RvYy5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2ItdG9jJyk7XG5cdFx0XHR0aGlzLl90b2MuYXBwZW5kQ2hpbGQodG9jVGl0bGUpO1xuXHRcdH1cblx0XHR0aGlzLl9zZWN0aW9ucy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0aWYoIXZhbC5jbGFzc05hbWUubWF0Y2goL3diLW5vLXRvYy8pKSB7XG5cdFx0XHRcdGxldCBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRcdFx0XHRwLmlubmVySFRNTCA9IHZhbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2ItdGl0bGUnKTtcblx0XHRcdFx0cC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywnd2ItdG9jLWl0ZW0nKTtcblx0XHRcdFx0bGV0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG5cdFx0XHRcdGEuc2V0QXR0cmlidXRlKCdocmVmJywgJyMnICsgdmFsLmlkKTtcblx0XHRcdFx0YS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3diLWxpbmsnKTtcblx0XHRcdFx0YS5zZXRBdHRyaWJ1dGUoJ2RhdGEtd2ItZWxlbWVudC1wYWdlLW51bWJlcicsIHZhbC5pZCk7XG5cdFx0XHRcdHAuYXBwZW5kQ2hpbGQoYSk7XG5cdFx0XHRcdHRoaXMuX3RvYy5hcHBlbmRDaGlsZChwKTtcblx0XHRcdH1cblx0XHR9KVxuXHR9XG5cdFxuXHRnZXRUb2NDdXJyZW50U2VjdGlvbigpIHtcblx0XHRsZXQgcG9zaXRpb24gPSAtdGhpcy5fcG9zaXRpb247XG5cdFx0Zm9yKGxldCBpPTE7IGk8dGhpcy5fc2VjdGlvbnMubGVuZ3RoOyBpKyspIHtcblx0XHRcdGlmKHRoaXMuX3NlY3Rpb25zW2ldLm9mZnNldExlZnQtdGhpcy5fY29udGFpbmVyV2lkdGg+PXBvc2l0aW9uKSB7XG5cdFx0XHRcdGxldCBpZCA9IHRoaXMuX3NlY3Rpb25zW2ktMV0uaWQ7XG5cdFx0XHRcdHRoaXMuX3RvYy5xdWVyeVNlbGVjdG9yQWxsKCdhJykuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdFx0XHRpZih2YWwuZ2V0QXR0cmlidXRlKCdocmVmJykucmVwbGFjZSgvXiMvLCcnKSA9PT0gaWQpIHtcblx0XHRcdFx0XHRcdGlmKCF2YWwucGFyZW50RWxlbWVudC5jbGFzc05hbWUubWF0Y2goL2N1cnJlbnQvKSkge1xuXHRcdFx0XHRcdFx0XHR2YWwucGFyZW50RWxlbWVudC5jbGFzc05hbWUrPScgY3VycmVudCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlmKHZhbC5wYXJlbnRFbGVtZW50LmNsYXNzTmFtZS5tYXRjaCgvY3VycmVudC8pKSB7XG5cdFx0XHRcdFx0XHRcdHZhbC5wYXJlbnRFbGVtZW50LmNsYXNzTmFtZT12YWwucGFyZW50RWxlbWVudC5jbGFzc05hbWUucmVwbGFjZSgvIGN1cnJlbnQvLCcnKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpbnNlcnRCb29rbWFyaygpIHtcblx0XHRsZXQgYm9va21hcmsgPSBudWxsO1xuXHRcdGZvcihsZXQgaT0wOyBpPHRoaXMuX2VsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRsZXQgZWxQb3NpdGlvbiA9IHRoaXMuX2VsZW1lbnRzW2ldLm9mZnNldExlZnQtdGhpcy5nZXRNYXJnaW5YKCk7XG5cdFx0XHRlbFBvc2l0aW9uID0gKGVsUG9zaXRpb24ldGhpcy5fY29udGFpbmVyV2lkdGghPT0wID8gZWxQb3NpdGlvbi1lbFBvc2l0aW9uJXRoaXMuX2NvbnRhaW5lcldpZHRoIDogZWxQb3NpdGlvbik7Ly9hbHdheXMgYXQgYSBwYWdlIGJlZ2lubmluZ1xuXHRcdFx0aWYoZWxQb3NpdGlvbiA9PT0gLXRoaXMuX3Bvc2l0aW9uKVxuXHRcdFx0e1xuXHRcdFx0XHRib29rbWFyayA9IGk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSBpZihlbFBvc2l0aW9uID4gLXRoaXMuX3Bvc2l0aW9uKVxuXHRcdFx0e1xuXHRcdFx0XHRib29rbWFyayA9IGktMTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHRoaXMuX2Jvb2ttYXJrID0gYm9va21hcms7XG5cdH1cblxuXHRnb1RvQm9va21hcmsoYm9va21hcmspIHtcblx0XHRsZXQgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnRzW3RoaXMuX2Jvb2ttYXJrXTtcblx0XHQvL3Bvc2l0aW9uIDogb2Zmc2V0TGVmdCBvZiBlbGVtZW50IHJlbGF0aXZlIHRvIHRleHRcblx0XHRsZXQgcG9zaXRpb24gPSBlbGVtZW50Lm9mZnNldExlZnQtdGhpcy5nZXRNYXJnaW5YKCk7XG5cdFx0cG9zaXRpb24gPSAocG9zaXRpb24ldGhpcy5fY29udGFpbmVyV2lkdGghPT0wID8gcG9zaXRpb24tcG9zaXRpb24ldGhpcy5fY29udGFpbmVyV2lkdGggOiBwb3NpdGlvbik7Ly9hbHdheXMgYXQgYSBwYWdlIGJlZ2lubmluZ1xuXHRcdC8vdGV4dCBwb3NpdGlvbiA9IC1wb3NpdGlvblxuXHRcdHRoaXMuX3RleHQuc3R5bGUubGVmdCA9IC1wb3NpdGlvbiArIFwicHhcIjtcblx0XHR0aGlzLl9wb3NpdGlvbiA9IHRoaXMuX3RleHQub2Zmc2V0TGVmdDtcblx0XHR0aGlzLnJlZnJlc2goKTtcblx0fVxuXG5cdHJlZnJlc2goKSB7XG5cdFx0dGhpcy5pbnNlcnRCb29rbWFyaygpO1xuXG5cdFx0aWYodGhpcy5jb2w9PT1mYWxzZSkge1xuXHRcdFx0XG5cdFx0XHR0aGlzLl9jdXJyZW50UGFnZXMuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdFx0dmFsLmlubmVySFRNTCA9IFwiXCI7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5fdG90YWxQYWdlcy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0XHR2YWwuaW5uZXJIVE1MID0gXCJcIjtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLl9jdXJyZW50VG90YWxQYWdlcy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0XHR2YWwuaW5uZXJIVE1MID0gXCJcIjtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHR0aGlzLl9lbFBhZ2VOdW1iZXJzLmZvckVhY2goIHZhbCA9PiB7XG5cdFx0XHRcdHZhbC5pbm5lckhUTUwgPSBcIlwiO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuX3NlY3Rpb25UaXRsZXMuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdFx0dmFsLmlubmVySFRNTCA9IFwiXCI7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdH0gZWxzZSB7XG5cdFx0XHRcblx0XHRcdHRoaXMuZ2V0UGFnZVNjb3BlKCk7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMuX3RvYykge1xuXHRcdFx0XHR0aGlzLmdldFRvY0N1cnJlbnRTZWN0aW9uKCk7XG5cdFx0XHR9XHRcblx0XHRcdFxuXHRcdFx0dGhpcy5fY3VycmVudFBhZ2VzLmZvckVhY2goIHZhbCA9PiB7XG5cdFx0XHRcdGlmKHZhbC5pbm5lckhUTUwhPXRoaXMuZ2V0UGFnZU51bWJlcigpKSB7XG5cdFx0XHRcdFx0dmFsLmlubmVySFRNTCA9IHRoaXMuZ2V0UGFnZU51bWJlcigpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5fdG90YWxQYWdlcy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0XHRpZih2YWwuaW5uZXJIVE1MIT10aGlzLmdldFRvdGFsUGFnZXMoKSkge1xuXHRcdFx0XHRcdHZhbC5pbm5lckhUTUwgPSB0aGlzLmdldFRvdGFsUGFnZXMoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuX2N1cnJlbnRUb3RhbFBhZ2VzLmZvckVhY2goIHZhbCA9PiB7XG5cdFx0XHRcdGlmKHRoaXMuZ2V0UGFnZU51bWJlcigpIDwgMSkge1xuXHRcdFx0XHRcdHZhbC5pbm5lckhUTUwgPSBcIiZlbXNwOyZlbXNwO1wiO1xuXHRcdFx0XHR9IGVsc2UgaWYodmFsLmlubmVySFRNTCE9PSB0aGlzLmdldFBhZ2VOdW1iZXIoKSArIFwiL1wiICsgdGhpcy5nZXRUb3RhbFBhZ2VzKCkpIHtcblx0XHRcdFx0XHR2YWwuaW5uZXJIVE1MID0gdGhpcy5nZXRQYWdlTnVtYmVyKCkgKyBcIi9cIiArIHRoaXMuZ2V0VG90YWxQYWdlcygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5fZWxQYWdlTnVtYmVycy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0XHRsZXQgaWQgPSB2YWwuZ2V0QXR0cmlidXRlKCdkYXRhLXdiLWVsZW1lbnQtcGFnZS1udW1iZXInKTtcblx0XHRcdFx0bGV0IHBhZ2VOdW1iZXIgPSB0aGlzLmVsZW1lbnRQYWdlTnVtYmVyKGlkKTtcblx0XHRcdFx0aWYocGFnZU51bWJlciA8IDEpIHtcblx0XHRcdFx0XHR2YWwuaW5uZXJIVE1MID0gXCJcIjtcblx0XHRcdFx0fSBlbHNlIGlmKHZhbC5pbm5lckhUTUwhPXBhZ2VOdW1iZXIpIHtcblx0XHRcdFx0XHR2YWwuaW5uZXJIVE1MID0gcGFnZU51bWJlcjtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRoaXMuX3NlY3Rpb25UaXRsZXMuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdFx0aWYodmFsLmlubmVySFRNTCE9PXRoaXMuZ2V0U2VjdGlvblRpdGxlKCkpIHtcblx0XHRcdFx0XHR2YWwuaW5uZXJIVE1MID0gdGhpcy5nZXRTZWN0aW9uVGl0bGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHR9XG5cdH1cbn1cblxuIl19
