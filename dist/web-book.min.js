"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),WebBook=function(){function t(e,i){var n=this;_classCallCheck(this,t),this._bookContainer=e,this._textContainer=e.querySelector("[data-wb-text-container]"),this._text=e.querySelector("[data-wb-text]"),this._height=i.height,this._width=i.maxWidth,this._marginX=void 0===i.marginX?35:i.marginX,this._marginY=void 0===i.marginY?20:i.marginY,this._position=0,this.col=!0,this._bookmark=null,this._containerWidth=null,this._lastBreak=document.createElement("div"),this._lastBreak.className="wb-text-break",this._text.appendChild(this._lastBreak),this._lastElement=document.createElement("div"),this._lastElement.innerHTML="&nbsp;",this._lastElement.className="wb-section wb-no-toc",this._text.appendChild(this._lastElement),this._sections=this._text.querySelectorAll(".wb-section"),this._breaks=this._text.querySelectorAll(".wb-text-break"),this._elements=this._text.querySelectorAll(":not(.wb-text-break)"),this._toc=this._bookContainer.querySelector("[data-wb-toc]"),this.getToc(),this._currentPages=this._bookContainer.querySelectorAll(".wb-current-page"),this._totalPages=this._bookContainer.querySelectorAll(".wb-total-pages"),this._currentTotalPages=this._bookContainer.querySelectorAll(".wb-currentByTotal-pages"),this._elPageNumbers=this._bookContainer.querySelectorAll("[data-wb-element-page-number]"),this._sectionTitles=this._bookContainer.querySelectorAll(".wb-current-section-title"),this._startPage=null,this._bookContainer.querySelectorAll(".wb-link").forEach(function(t){t.addEventListener("click",function(t){if(!0===n.col){t.preventDefault();var e=t.currentTarget.getAttribute("href").replace(/^#/,"");n.goToPage(n.elementPageNumber(e))}},!1)}),("WebkitColumnWidth"in document.body.style||"MozColumnWidth"in document.body.style||"columnWidth"in document.body.style)&&this.toBook()}return _createClass(t,[{key:"toBook",value:function(){if("WebkitColumnWidth"in document.body.style||"MozColumnWidth"in document.body.style||"columnWidth"in document.body.style){this.col=!0;var t=this._textContainer.style,e=this._text.style;t.boxSizing="border-box",t.overflow="hidden",t.position="relative",t.left=0,t.top=0,t.padding="0px",t.height=this.getHeight()+"px",t.maxWidth=this.getWidth()+"px",this._containerWidth=this._textContainer.clientWidth;for(var i=0;i<this._sections.length;i++)"10%"!==this._sections[i].style.minHeight&&(this._sections[i].style.minHeight="10%");for(var n=0;n<this._breaks.length;n++)"300%"!==this._breaks[n].style.marginBottom&&(this._breaks[n].style.marginBottom="300%");"300%"!==this._lastElement.style.marginBottom&&(this._lastElement.style.marginBottom="300%"),e.boxSizing="border-box",e.position="absolute",e.left=0,e.top=0,e.height="100%",e.width="100%",e.paddingRight=this.getMarginX()+"px",e.paddingLeft=this.getMarginX()+"px",e.paddingTop=this.getMarginY()+"px",e.paddingBottom=this.getMarginY()+"px",e.MozColumnFill="auto",e.WebkitColumnsWidth=this._containerWidth+"px",e.MozColumnWidth=this._containerWidth+"px",e.columnWidth=this._containerWidth+"px",e.MozColumnGap=2*this.getMarginX()+"px",e.WebkitColumnGap=2*this.getMarginX()+"px",e.columnGap=2*this.getMarginX()+"px",this._bookmark&&(this.goToBookmark(this._bookmark),this._position=this._text.offsetLeft),this.refresh()}}},{key:"toScroll",value:function(){this.col=!1;var t=this._container.style,e=this._text.style;t.height="auto",t.maxWidth=this.getWidth()+"px",t.overflow="visible",e.position="static",e.height="auto",t.paddingRight=this.getMarginX()+"px",t.paddingLeft=this.getMarginX()+"px",t.paddingTop=this.getMarginY()+"px",t.paddingBottom=this.getMarginY()+"px",("WebkitColumnWidth"in document.body.style||"MozColumnWidth"in document.body.style||"columnWidth"in document.body.style)&&(e.WebkitColumns="auto 1",e.MozColumns="auto 1",e.columns="auto 1");for(var i=0;i<this._sections.length;i++)this._sections[i].style.minHeight="0";for(var n=0;n<this._breaks.length;n++)this._breaks[n].style.marginBottom="0";this._lastElement.style.marginBottom="0px",this.refresh()}},{key:"setWidth",value:function(t){return this._width=t,this}},{key:"getWidth",value:function(){return this._width}},{key:"setHeight",value:function(t){return this._height=t,this}},{key:"getHeight",value:function(){return this._height}},{key:"setMarginX",value:function(t){return this._marginX=t,this}},{key:"getMarginX",value:function(){return this._marginX}},{key:"setMarginY",value:function(t){return this._marginY=t,this}},{key:"getMarginY",value:function(){return this._marginY}},{key:"forward",value:function(){this._lastElement.offsetLeft+this._position>this._containerWidth+this.getMarginX()&&(this._position=this._text.offsetLeft,this._position-=this._containerWidth,this._text.style.left=this._position+"px",this.refresh())}},{key:"backward",value:function(){this._position<0&&(this._position=this._text.offsetLeft,this._position+=this._containerWidth,this._text.style.left=this._position+"px",this.refresh())}},{key:"tofirstPage",value:function(){this._position<0&&(this._position=0,this._text.style.left=this._position+"px",this.refresh())}},{key:"tolastPage",value:function(){this._lastElement.offsetLeft+this._position>this._containerWidth+this.getMarginX()&&(this._position=this._containerWidth+this.getMarginX()-this._lastElement.offsetLeft,this._text.style.left=this._position+"px",this.refresh())}},{key:"getPageStart",value:function(){for(var t=void 0,e=void 0,i=0;i<this._sections.length-1;i++)if(this._sections[i].className.match(/wb-no-page/))t=i;else if(void 0!==t&&void 0===e){e=i;var n=this._sections[e].offsetLeft-this.getMarginX();n=n%this._containerWidth!=0?n-n%this._containerWidth:n,this._startPage=n/this._containerWidth}}},{key:"getPageNumber",value:function(){var t=Math.abs(Math.floor(this._position/this._containerWidth))+1;return t-=this._startPage}},{key:"getTotalPages",value:function(){var t=Math.floor(this._lastElement.offsetLeft/this._containerWidth);return t-=this._startPage}},{key:"goToPage",value:function(t){t=(t=t<1-this._startPage?1-this._startPage:t)>this.getTotalPages()?this.getTotalPages():t,t+=this._startPage;var e=this._containerWidth*(t-1);this._text.style.left=-e+"px",this._position=this._text.offsetLeft,this.refresh()}},{key:"elementPageNumber",value:function(t){var e=this._text.querySelector("#"+t).offsetLeft-this.getMarginX(),i=(e=e%this._containerWidth!=0?e-e%this._containerWidth:e)/this._containerWidth+1;return i-=this._startPage}},{key:"getSectionTitle",value:function(){for(var t=-this._position,e=void 0,i=1;i<this._sections.length;i++)if(this._sections[i].offsetLeft-this._containerWidth>=t){var n=this._sections[i-1].id;e=void 0!==n&&this.getPageNumber()===this.elementPageNumber(n)?"":this._sections[i-1].title;break}return e}},{key:"getToc",value:function(){if(this._toc){if(this._toc.getAttribute("data-wb-toc")){var t=document.createElement("p");t.setAttribute("class","wb-toc-title"),t.innerHTML=this._toc.getAttribute("data-wb-toc"),this._toc.appendChild(t)}var e=document.createElement("ul");e.setAttribute("class","wb-toc-list"),this._sections.forEach(function(t){if(!t.className.match(/wb-no-toc/)){var i=document.createElement("li");i.setAttribute("class","wb-toc-item");var n=document.createElement("a");n.setAttribute("href","#"+t.id),n.setAttribute("class","wb-link");var s=document.createElement("span");s.setAttribute("class","wb-toc-item-title"),s.innerHTML=t.title;var o=document.createElement("span");s.setAttribute("class","wb-toc-item-page-number"),o.setAttribute("data-wb-element-page-number",t.id),n.appendChild(s),n.appendChild(o),i.appendChild(n),e.appendChild(i)}}),this._toc.appendChild(e)}}},{key:"getTocCurrentSection",value:function(){for(var t=this,e=-this._position,i=1;i<this._sections.length&&!(this._sections[i].offsetLeft-this._containerWidth>=e&&"break"===function(){var e=t._sections[i-1].id;return t._toc.querySelectorAll("a").forEach(function(t){t.getAttribute("href").replace(/^#/,"")===e?t.parentElement.className.match(/current/)||(t.parentElement.className+=" current"):t.parentElement.className.match(/current/)&&(t.parentElement.className=t.parentElement.className.replace(/ current/,""))}),"break"}());i++);}},{key:"insertBookmark",value:function(){for(var t=null,e=0;e<this._elements.length;e++){var i=this._elements[e].offsetLeft-this.getMarginX();if((i=i%this._containerWidth!=0?i-i%this._containerWidth:i)===-this._position){t=e;break}if(i>-this._position){t=e-1;break}}this._bookmark=t}},{key:"goToBookmark",value:function(t){var e=this._elements[this._bookmark].offsetLeft-this.getMarginX();e=e%this._containerWidth!=0?e-e%this._containerWidth:e,this._text.style.left=-e+"px",this._position=this._text.offsetLeft,this.refresh()}},{key:"refresh",value:function(){var t=this;this.insertBookmark(),!1===this.col?(this._currentPages.forEach(function(t){t.innerHTML=""}),this._totalPages.forEach(function(t){t.innerHTML=""}),this._currentTotalPages.forEach(function(t){t.innerHTML=""}),this._elPageNumbers.forEach(function(t){t.innerHTML=""}),this._sectionTitles.forEach(function(t){t.innerHTML=""})):(this.getPageStart(),this._toc&&this.getTocCurrentSection(),this._currentPages.forEach(function(e){e.innerHTML!=t.getPageNumber()&&(e.innerHTML=t.getPageNumber())}),this._totalPages.forEach(function(e){e.innerHTML!=t.getTotalPages()&&(e.innerHTML=t.getTotalPages())}),this._currentTotalPages.forEach(function(e){t.getPageNumber()<1?e.innerHTML="&emsp;&emsp;":e.innerHTML!==t.getPageNumber()+"/"+t.getTotalPages()&&(e.innerHTML=t.getPageNumber()+"/"+t.getTotalPages())}),this._elPageNumbers.forEach(function(e){var i=e.getAttribute("data-wb-element-page-number"),n=t.elementPageNumber(i);n<1?e.innerHTML="":e.innerHTML!=n&&(e.innerHTML=n)}),this._sectionTitles.forEach(function(e){e.innerHTML!==t.getSectionTitle()&&(e.innerHTML=t.getSectionTitle())}))}}]),t}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYi1ib29rLmpzIl0sIm5hbWVzIjpbIldlYkJvb2siLCJib29rQ29udGFpbmVyIiwib3B0aW9ucyIsIl90aGlzIiwidGhpcyIsIl9jbGFzc0NhbGxDaGVjayIsIl9ib29rQ29udGFpbmVyIiwiX3RleHRDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiX3RleHQiLCJfaGVpZ2h0IiwiX3dpZHRoIiwibWF4V2lkdGgiLCJfbWFyZ2luWCIsInVuZGVmaW5lZCIsIm1hcmdpblgiLCJfbWFyZ2luWSIsIm1hcmdpblkiLCJfcG9zaXRpb24iLCJoZWlnaHQiLCJfbGFzdEVsZW1lbnQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJjb2wiLCJjbGFzc05hbWUiLCJfYm9va21hcmsiLCJfc2VjdGlvbnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2xhc3RCcmVhayIsIl9lbGVtZW50cyIsIl90b3RhbFBhZ2VzIiwiX2JyZWFrcyIsIl9lbFBhZ2VOdW1iZXJzIiwiX3RvYyIsImZvckVhY2giLCJ2YWwiLCJfY3VycmVudFBhZ2VzIiwiZSIsIl9jdXJyZW50VG90YWxQYWdlcyIsIl9zZWN0aW9uVGl0bGVzIiwiZ29Ub1BhZ2UiLCJlbGVtZW50UGFnZU51bWJlciIsImlkIiwiYm9keSIsInN0eWxlIiwicHJldmVudERlZmF1bHQiLCJjcyIsInRzIiwidG9Cb29rIiwiYm94U2l6aW5nIiwib3ZlcmZsb3ciLCJwb3NpdGlvbiIsImxlZnQiLCJ0b3AiLCJwYWRkaW5nIiwiZ2V0SGVpZ2h0IiwiY2xpZW50V2lkdGgiLCJpIiwibGVuZ3RoIiwibWluSGVpZ2h0IiwiX2NvbnRhaW5lcldpZHRoIiwibWFyZ2luQm90dG9tIiwid2lkdGgiLCJwYWRkaW5nUmlnaHQiLCJwYWRkaW5nTGVmdCIsImdldE1hcmdpblgiLCJwYWRkaW5nVG9wIiwiZ2V0TWFyZ2luWSIsInBhZGRpbmdCb3R0b20iLCJNb3pDb2x1bW5GaWxsIiwiV2Via2l0Q29sdW1uc1dpZHRoIiwib2Zmc2V0TGVmdCIsIldlYmtpdENvbHVtbkdhcCIsIl9jb250YWluZXIiLCJnZXRXaWR0aCIsImNvbHVtbnMiLCJyZWZyZXNoIiwidyIsImgiLCJtIiwiaW5kZXgiLCJtYXRjaCIsInN0YXJ0SW5kZXgiLCJlbFBvc2l0aW9uIiwicGFnZU51bWJlciIsIk1hdGgiLCJfc3RhcnRQYWdlIiwidG90YWxQYWdlcyIsImZsb29yIiwibnVtYmVyIiwiZ2V0VG90YWxQYWdlcyIsImVsUGFnZU51bWJlciIsInRpdGxlIiwiZ2V0UGFnZU51bWJlciIsImdldEF0dHJpYnV0ZSIsInRvY1RpdGxlIiwic2V0QXR0cmlidXRlIiwibGlzdCIsIml0ZW0iLCJsaW5rIiwicGFnZSIsImFwcGVuZENoaWxkIiwiX3RoaXMyIiwicmVwbGFjZSIsInBhcmVudEVsZW1lbnQiLCJib29rbWFyayIsIl90aGlzMyIsImluc2VydEJvb2ttYXJrIiwiZ2V0UGFnZVN0YXJ0IiwiZWxlbWVudCIsImdldFNlY3Rpb25UaXRsZSJdLCJtYXBwaW5ncyI6IjZYQUFNQSxtQkFDTCxTQUFBQSxFQUFZQyxFQUFlQyxHQUFTLElBQUFDLEVBQUFDLEtBQUFDLGdCQUFBRCxLQUFBSixHQUVuQ0ksS0FBS0UsZUFBaUJMLEVBQ3RCRyxLQUFLRyxlQUFpQk4sRUFBY08sY0FBYyw0QkFDbERKLEtBQUtLLE1BQVFSLEVBQWNPLGNBQWMsa0JBSjFDSixLQUFBTSxRQUFBUixFQUFZRCxPQUF3QkcsS0FBQU8sT0FBQVQsRUFBQVUsU0FRbkNSLEtBQUtTLGNBQTZCQyxJQUFsQlosRUFBUWEsUUFBc0IsR0FBS2IsRUFBUWEsUUFSeEJYLEtBQUFZLGNBQUFGLElBQUFaLEVBQUFlLFFBQUEsR0FBQWYsRUFBQWUsUUFDbkNiLEtBQUFjLFVBQUEsRUFDQWQsS0FBS0UsS0FBQUEsRUFDTEYsS0FBS0csVUFBQUEsS0FDTEgsS0FBS0ssZ0JBQVFSLEtBRWJHLEtBQUtNLFdBQVVSLFNBQVFpQixjQUF2QixPQUNBZixLQUFLTyxXQUFTVCxVQUFRVSxnQkFDdEJSLEtBQUtTLE1B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RUFBSWIsVUFBWW9GLEVBQUtoQixtQkFJdkJ2RixLQUFLbUMsbUJBQW1CSixRQUFTLFNBQUFDLEdBMUMvQnVFLEVBQUtuRixnQkFBYSxFQTRDbEJZLEVBQUliLFVBQVksZUExQ2JjLEVBQUFBLFlBQXVCc0UsRUFBQWIsZ0JBQU8sSUFBQWEsRUFBQWhCLGtCQUNsQ3ZELEVBQUliLFVBQVlvRixFQUFoQmIsZ0JBQUEsSUFBQWEsRUFBQWhCLG1CQUlBdkQsS0FBQUEsZUFBQUQsUUFBQSxTQUFBQyxHQUNBLElBRkRPLEVBQUFQLEVBQUEyRCxhQUFBLCtCQThDS1YsRUFBYXNCLEVBQUtqRSxrQkFBa0JDLEdBMUN6QzBDLEVBQUs5QyxFQUNKSCxFQUFJYixVQUFZLEdBRGpCYSxFQUFBYixXQUFBOEQsSUE4Q0VqRCxFQUFJYixVQUFZOEQsS0FJbEJqRixLQUFLb0MsZUFBZUwsUUFBUyxTQUFBQyxHQTFDN0JBLEVBQUtJLFlBQUxtRSxFQUFvQnhFLG9CQUNuQkMsRUFBSWIsVUFBWW9GLEVBQWhCSSIsImZpbGUiOiJ3ZWItYm9vay5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBXZWJCb29rIHtcblx0Y29uc3RydWN0b3IoYm9va0NvbnRhaW5lciwgb3B0aW9ucykge1xuXHRcdC8vY29udGFpbmVyc1xuXHRcdHRoaXMuX2Jvb2tDb250YWluZXIgPSBib29rQ29udGFpbmVyO1xuXHRcdHRoaXMuX3RleHRDb250YWluZXIgPSBib29rQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXdiLXRleHQtY29udGFpbmVyXScpO1xuXHRcdHRoaXMuX3RleHQgPSBib29rQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXdiLXRleHRdJyk7XG5cdFx0Ly9vcHRpb25zXG5cdFx0dGhpcy5faGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG5cdFx0dGhpcy5fd2lkdGggPSBvcHRpb25zLm1heFdpZHRoO1xuXHRcdHRoaXMuX21hcmdpblggPSBvcHRpb25zLm1hcmdpblg9PT11bmRlZmluZWQgPyAzNSA6IG9wdGlvbnMubWFyZ2luWDtcblx0XHR0aGlzLl9tYXJnaW5ZID0gb3B0aW9ucy5tYXJnaW5ZPT09dW5kZWZpbmVkID8gMjAgOiBvcHRpb25zLm1hcmdpblk7XG5cdFx0Ly9pbml0IHBvc2l0aW9uLCBjb2wgLGNvbnRhaW5lcldpZHRoIGFuZCBib29rbWFya1xuXHRcdHRoaXMuX3Bvc2l0aW9uID0gMDtcblx0XHR0aGlzLmNvbCA9IHRydWU7Ly9kZWZhdWx0IHRydWUgPSB0b0Jvb2soKVxuXHRcdHRoaXMuX2Jvb2ttYXJrID0gbnVsbDtcblx0XHR0aGlzLl9jb250YWluZXJXaWR0aCA9IG51bGw7XG5cdFx0Ly90aGlzLmxhc3RCcmVhayBpcyB1c2VkIGFzIGEgZ2hvc3QgcGFnZVxuXHRcdHRoaXMuX2xhc3RCcmVhayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0dGhpcy5fbGFzdEJyZWFrLmNsYXNzTmFtZSA9IFwid2ItdGV4dC1icmVha1wiO1xuXHRcdHRoaXMuX3RleHQuYXBwZW5kQ2hpbGQodGhpcy5fbGFzdEJyZWFrKTtcblx0XHQvL3RoaXMuX2xhc3RFbGVtZW50IGlzIHVzZWQgYXMgbGFuZG1hcmtcblx0XHR0aGlzLl9sYXN0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0dGhpcy5fbGFzdEVsZW1lbnQuaW5uZXJIVE1MID0gXCImbmJzcDtcIjsvL25vdCBlbXB0eSAoZm9yIG1vekNvbHVtbnMpXG5cdFx0dGhpcy5fbGFzdEVsZW1lbnQuY2xhc3NOYW1lID0gXCJ3Yi1zZWN0aW9uIHdiLW5vLXRvY1wiO1xuXHRcdHRoaXMuX3RleHQuYXBwZW5kQ2hpbGQodGhpcy5fbGFzdEVsZW1lbnQpO1xuXHRcdC8vc2VjdGlvbnNcblx0XHR0aGlzLl9zZWN0aW9ucyA9IHRoaXMuX3RleHQucXVlcnlTZWxlY3RvckFsbCgnLndiLXNlY3Rpb24nKTtcblx0XHQvL2JyZWFrc1xuXHRcdHRoaXMuX2JyZWFrcyA9IHRoaXMuX3RleHQucXVlcnlTZWxlY3RvckFsbCgnLndiLXRleHQtYnJlYWsnKTtcblx0XHQvL2VsZW1lbnRzIDogc2VsZWN0IGFsbCBlbGVtZW50cyBidXQgLnRleHQtYnJlYWtzIChmb3IgYm9va21hcmtzKVxuXHRcdHRoaXMuX2VsZW1lbnRzID0gdGhpcy5fdGV4dC5xdWVyeVNlbGVjdG9yQWxsKCc6bm90KC53Yi10ZXh0LWJyZWFrKScpO1xuXHRcdC8vdG9jXG5cdFx0dGhpcy5fdG9jID0gdGhpcy5fYm9va0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdbZGF0YS13Yi10b2NdJyk7XG5cdFx0Ly9zZXRUb2MgYmVmb3JlIHF1ZXJ5aW5nIHRoaXMuZWxQYWdlTnVtYmVyc1xuXHRcdHRoaXMuZ2V0VG9jKCk7XG5cdFx0Ly9pbmZvcyBjb250YWluZXJzXG5cdFx0dGhpcy5fY3VycmVudFBhZ2VzID0gdGhpcy5fYm9va0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcud2ItY3VycmVudC1wYWdlJyk7XG5cdFx0dGhpcy5fdG90YWxQYWdlcyA9IHRoaXMuX2Jvb2tDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLndiLXRvdGFsLXBhZ2VzJyk7XG5cdFx0dGhpcy5fY3VycmVudFRvdGFsUGFnZXMgPSB0aGlzLl9ib29rQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy53Yi1jdXJyZW50QnlUb3RhbC1wYWdlcycpO1xuXHRcdHRoaXMuX2VsUGFnZU51bWJlcnMgPSB0aGlzLl9ib29rQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXdiLWVsZW1lbnQtcGFnZS1udW1iZXJdJyk7XG5cdFx0dGhpcy5fc2VjdGlvblRpdGxlcyA9IHRoaXMuX2Jvb2tDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLndiLWN1cnJlbnQtc2VjdGlvbi10aXRsZScpO1xuXHRcdC8vc3RhcnQgcGFnaW5hdGlvblxuXHRcdHRoaXMuX3N0YXJ0UGFnZSA9IG51bGw7XG5cdFx0Ly9saW5rcyA6IHJlcGxhY2UgZGVmYXVsdCB3aXRoIGdvVG9QYWdlXG5cdFx0bGV0IGxpbmtzID0gdGhpcy5fYm9va0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcud2ItbGluaycpO1xuXHRcdGxpbmtzLmZvckVhY2goIHZhbCA9PiB7XG5cdFx0XHR2YWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcblx0XHRcdFx0aWYodGhpcy5jb2w9PT10cnVlKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdGxldCBocmVmID0gZS5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpO1xuXHRcdFx0XHRcdGxldCBpZCA9IGhyZWYucmVwbGFjZSgvXiMvLFwiXCIpO1xuXHRcdFx0XHRcdHRoaXMuZ29Ub1BhZ2UodGhpcy5lbGVtZW50UGFnZU51bWJlcihpZCkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCBmYWxzZSk7XG5cdFx0fSlcblx0XHRcblx0XHRcblx0XHRpZignV2Via2l0Q29sdW1uV2lkdGgnIGluIGRvY3VtZW50LmJvZHkuc3R5bGUgfHwgJ01vekNvbHVtbldpZHRoJyBpbiBkb2N1bWVudC5ib2R5LnN0eWxlIHx8ICdjb2x1bW5XaWR0aCcgaW4gZG9jdW1lbnQuYm9keS5zdHlsZSkge1xuXHRcdFx0dGhpcy50b0Jvb2soKTtcblx0XHR9XG5cblx0fVxuXG5cdHRvQm9vaygpIHtcblx0XHRpZignV2Via2l0Q29sdW1uV2lkdGgnIGluIGRvY3VtZW50LmJvZHkuc3R5bGUgfHwgJ01vekNvbHVtbldpZHRoJyBpbiBkb2N1bWVudC5ib2R5LnN0eWxlIHx8ICdjb2x1bW5XaWR0aCcgIGluIGRvY3VtZW50LmJvZHkuc3R5bGUpIHtcblx0XHRcdHRoaXMuY29sID0gdHJ1ZTtcblx0XHRcdGxldCBjcyA9IHRoaXMuX3RleHRDb250YWluZXIuc3R5bGU7XG5cdFx0XHRsZXQgdHMgPSB0aGlzLl90ZXh0LnN0eWxlO1xuXHRcdFx0Ly90ZXh0LWNvbnRhaW5lclxuXHRcdFx0Y3MuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cdFx0XHRjcy5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG5cdFx0XHRjcy5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcblx0XHRcdGNzLmxlZnQgPSAwO1xuXHRcdFx0Y3MudG9wID0gMDtcblx0XHRcdGNzLnBhZGRpbmcgPSBcIjBweFwiO1xuXHRcdFx0Y3MuaGVpZ2h0ID0gdGhpcy5nZXRIZWlnaHQoKSArIFwicHhcIjtcblx0XHRcdGNzLm1heFdpZHRoID0gdGhpcy5nZXRXaWR0aCgpICsgXCJweFwiOy8vbWF4V2lkdGggOiByZXNwb25zaXZlXG5cdFx0XHR0aGlzLl9jb250YWluZXJXaWR0aCA9IHRoaXMuX3RleHRDb250YWluZXIuY2xpZW50V2lkdGg7Ly9yZXNwb25zaXZlXG5cdFx0XHRcblx0XHRcdC8vc2VjdGlvbnNcblx0XHRcdC8vaGFjayBmaXJlZm94IChwb3VyIG9mZnNldExlZnQpIDogbWluSGVpZ2h0ID0gMTAlXG5cdFx0XHRmb3IobGV0IGk9MDsgaTx0aGlzLl9zZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRpZih0aGlzLl9zZWN0aW9uc1tpXS5zdHlsZS5taW5IZWlnaHQhPT1cIjEwJVwiKSB7XG5cdFx0XHRcdFx0dGhpcy5fc2VjdGlvbnNbaV0uc3R5bGUubWluSGVpZ2h0ID0gXCIxMCVcIjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly9tYW51YWwgYnJlYWtzXG5cdFx0XHRmb3IobGV0IGk9MDsgaTx0aGlzLl9icmVha3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYodGhpcy5fYnJlYWtzW2ldLnN0eWxlLm1hcmdpbkJvdHRvbSE9PVwiMzAwJVwiKSB7XG5cdFx0XHRcdFx0dGhpcy5fYnJlYWtzW2ldLnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMzAwJVwiO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHQvL2xhc3QgZWxlbWVudFxuXHRcdFx0aWYodGhpcy5fbGFzdEVsZW1lbnQuc3R5bGUubWFyZ2luQm90dG9tIT09XCIzMDAlXCIpIHtcblx0XHRcdFx0dGhpcy5fbGFzdEVsZW1lbnQuc3R5bGUubWFyZ2luQm90dG9tID0gXCIzMDAlXCI7XG5cdFx0XHR9XG5cblx0XHRcdC8vdGV4dFxuXHRcdFx0dHMuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cdFx0XHR0cy5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcblx0XHRcdHRzLmxlZnQgPSAwO1xuXHRcdFx0dHMudG9wID0gMDtcblx0XHRcdHRzLmhlaWdodCA9IFwiMTAwJVwiO1xuXHRcdFx0dHMud2lkdGggPSBcIjEwMCVcIjtcblx0XHRcdHRzLnBhZGRpbmdSaWdodCA9IHRoaXMuZ2V0TWFyZ2luWCgpICsgXCJweFwiO1xuXHRcdFx0dHMucGFkZGluZ0xlZnQgPSB0aGlzLmdldE1hcmdpblgoKSArIFwicHhcIjtcblx0XHRcdHRzLnBhZGRpbmdUb3AgPSB0aGlzLmdldE1hcmdpblkoKSArIFwicHhcIjtcblx0XHRcdHRzLnBhZGRpbmdCb3R0b20gPSB0aGlzLmdldE1hcmdpblkoKSArIFwicHhcIjtcblx0XHRcdHRzLk1vekNvbHVtbkZpbGwgPSBcImF1dG9cIjsvL2ltcG9ydGFudCAhISFcblx0XHRcdHRzLldlYmtpdENvbHVtbnNXaWR0aCA9IHRoaXMuX2NvbnRhaW5lcldpZHRoICsgXCJweFwiO1xuXHRcdFx0dHMuTW96Q29sdW1uV2lkdGggPSB0aGlzLl9jb250YWluZXJXaWR0aCArIFwicHhcIjtcblx0XHRcdHRzLmNvbHVtbldpZHRoID0gdGhpcy5fY29udGFpbmVyV2lkdGggKyBcInB4XCI7XG5cdFx0XHR0cy5Nb3pDb2x1bW5HYXAgPSB0aGlzLmdldE1hcmdpblgoKSoyICsgXCJweFwiO1xuXHRcdFx0dHMuV2Via2l0Q29sdW1uR2FwID0gdGhpcy5nZXRNYXJnaW5YKCkqMiArIFwicHhcIjtcblx0XHRcdHRzLmNvbHVtbkdhcCA9IHRoaXMuZ2V0TWFyZ2luWCgpKjIgKyBcInB4XCI7XG5cdFx0XHRcblx0XHRcdC8vR28gdG8gYm9va21hcmtcblx0XHRcdGlmKHRoaXMuX2Jvb2ttYXJrKSB7XG5cdFx0XHRcdHRoaXMuZ29Ub0Jvb2ttYXJrKHRoaXMuX2Jvb2ttYXJrKTtcblx0XHRcdFx0dGhpcy5fcG9zaXRpb24gPSB0aGlzLl90ZXh0Lm9mZnNldExlZnQ7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdC8vUmVmcmVzaCBpbmZvIGNvbnRhaW5lcnNcblx0XHRcdHRoaXMucmVmcmVzaCgpO1xuXHRcdFx0Ly9jb25zb2xlLmxvZyh0aGlzLl9ib29rQ29udGFpbmVyLm9mZnNldEhlaWdodCAtIHRoaXMuZ2V0SGVpZ2h0KCkpO1xuXHRcdH1cblx0fVxuXG5cdHRvU2Nyb2xsKCkge1xuXHRcdCd1c2Ugc3RyaWN0Jztcblx0XHR0aGlzLmNvbCA9IGZhbHNlO1xuXHRcdGxldCBjcyA9IHRoaXMuX2NvbnRhaW5lci5zdHlsZTtcblx0XHRsZXQgdHMgPSB0aGlzLl90ZXh0LnN0eWxlO1xuXHRcdC8vY29udGFpbmVyXG5cdFx0Y3MuaGVpZ2h0ID0gXCJhdXRvXCI7XG5cdFx0Y3MubWF4V2lkdGggPSB0aGlzLmdldFdpZHRoKCkgKyBcInB4XCI7XG5cdFx0Y3Mub3ZlcmZsb3cgPSBcInZpc2libGVcIjtcblx0XHQvL3RleHRcblx0XHR0cy5wb3NpdGlvbiA9IFwic3RhdGljXCI7XG5cdFx0dHMuaGVpZ2h0ID0gXCJhdXRvXCI7XG5cdFx0Y3MucGFkZGluZ1JpZ2h0ID0gdGhpcy5nZXRNYXJnaW5YKCkgKyBcInB4XCI7XG5cdFx0Y3MucGFkZGluZ0xlZnQgPSB0aGlzLmdldE1hcmdpblgoKSArIFwicHhcIjtcblx0XHRjcy5wYWRkaW5nVG9wID0gdGhpcy5nZXRNYXJnaW5ZKCkgKyBcInB4XCI7XG5cdFx0Y3MucGFkZGluZ0JvdHRvbSA9IHRoaXMuZ2V0TWFyZ2luWSgpICsgXCJweFwiO1xuXG5cdFx0aWYoJ1dlYmtpdENvbHVtbldpZHRoJyBpbiBkb2N1bWVudC5ib2R5LnN0eWxlIHx8ICdNb3pDb2x1bW5XaWR0aCcgaW4gZG9jdW1lbnQuYm9keS5zdHlsZSB8fCAnY29sdW1uV2lkdGgnICBpbiBkb2N1bWVudC5ib2R5LnN0eWxlKSB7XG5cdFx0XHR0cy5XZWJraXRDb2x1bW5zID0gXCJhdXRvIDFcIjtcblx0XHRcdHRzLk1vekNvbHVtbnMgPSBcImF1dG8gMVwiO1xuXHRcdFx0dHMuY29sdW1ucyA9IFwiYXV0byAxXCI7XG5cdFx0fVxuXG5cdFx0Ly9TZWN0aW9ucyAoZm9yIG1vekNvbHVtbnMpXG5cdFx0Zm9yKGxldCBpPTA7IGk8dGhpcy5fc2VjdGlvbnMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHRoaXMuX3NlY3Rpb25zW2ldLnN0eWxlLm1pbkhlaWdodCA9IFwiMFwiO1xuXHRcdH1cblx0XHQvL21hbnVhbCBicmVha3Ncblx0XHRmb3IobGV0IGk9MDsgaTx0aGlzLl9icmVha3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdHRoaXMuX2JyZWFrc1tpXS5zdHlsZS5tYXJnaW5Cb3R0b20gPSBcIjBcIjtcblx0XHR9XG5cdFx0Ly9sYXN0IGVsZW1lbnRcblx0XHR0aGlzLl9sYXN0RWxlbWVudC5zdHlsZS5tYXJnaW5Cb3R0b20gPSBcIjBweFwiO1xuXG5cdFx0dGhpcy5yZWZyZXNoKCk7XG5cdH07XG5cblx0c2V0V2lkdGgodykge1xuXHRcdHRoaXMuX3dpZHRoID0gdztcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdGdldFdpZHRoKCkge1xuXHRcdHJldHVybiB0aGlzLl93aWR0aDtcblx0fVxuXG5cdHNldEhlaWdodChoKSB7XG5cdFx0dGhpcy5faGVpZ2h0ID0gaDtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdGdldEhlaWdodCgpIHtcblx0XHRyZXR1cm4gdGhpcy5faGVpZ2h0O1xuXHR9XG5cblx0c2V0TWFyZ2luWChtKSB7XG5cdFx0dGhpcy5fbWFyZ2luWCA9IG07XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRnZXRNYXJnaW5YKCkge1xuXHRcdHJldHVybiB0aGlzLl9tYXJnaW5YO1xuXHR9XG5cblx0c2V0TWFyZ2luWShtKSB7XG5cdFx0dGhpcy5fbWFyZ2luWSA9IG07XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRnZXRNYXJnaW5ZKCkge1xuXHRcdHJldHVybiB0aGlzLl9tYXJnaW5ZO1xuXHR9XG5cblx0Zm9yd2FyZCgpIHtcblx0XHRpZih0aGlzLl9sYXN0RWxlbWVudC5vZmZzZXRMZWZ0K3RoaXMuX3Bvc2l0aW9uID4gdGhpcy5fY29udGFpbmVyV2lkdGgrdGhpcy5nZXRNYXJnaW5YKCkpIHtcblx0XHRcdC8vbGV0IGNsb25lID0gdGhpcy5fdGV4dC5jbG9uZU5vZGUodHJ1ZSk7XG5cdFx0XHR0aGlzLl9wb3NpdGlvbiA9IHRoaXMuX3RleHQub2Zmc2V0TGVmdDtcblx0XHRcdHRoaXMuX3Bvc2l0aW9uIC09IHRoaXMuX2NvbnRhaW5lcldpZHRoO1xuXHRcdFx0dGhpcy5fdGV4dC5zdHlsZS5sZWZ0ID0gdGhpcy5fcG9zaXRpb24gKyBcInB4XCI7XG5cdFx0XHRcblx0XHRcdC8vY29uc29sZS5sb2coY2xvbmUpO1xuXHRcdFx0Ly9jbG9uZS5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcblx0XHRcdC8vdGhpcy5fY29udGFpbmVyLmluc2VydEJlZm9yZShjbG9uZSx0aGlzLnRleHQpO1xuXHRcdFx0dGhpcy5yZWZyZXNoKCk7XG5cdFx0fVxuXHR9XG5cblx0YmFja3dhcmQoKSB7XG5cdFx0aWYodGhpcy5fcG9zaXRpb24gPCAwKSB7XG5cdFx0XHR0aGlzLl9wb3NpdGlvbiA9IHRoaXMuX3RleHQub2Zmc2V0TGVmdDtcblx0XHRcdHRoaXMuX3Bvc2l0aW9uICs9IHRoaXMuX2NvbnRhaW5lcldpZHRoO1xuXHRcdFx0dGhpcy5fdGV4dC5zdHlsZS5sZWZ0ID0gdGhpcy5fcG9zaXRpb24gKyBcInB4XCI7XG5cdFx0XHR0aGlzLnJlZnJlc2goKTtcblx0XHR9XG5cdH1cblxuXHR0b2ZpcnN0UGFnZSgpIHtcblx0XHRpZih0aGlzLl9wb3NpdGlvbiA8IDApIHtcblx0XHRcdHRoaXMuX3Bvc2l0aW9uID0gMDtcblx0XHRcdHRoaXMuX3RleHQuc3R5bGUubGVmdCA9IHRoaXMuX3Bvc2l0aW9uICsgXCJweFwiO1xuXHRcdFx0dGhpcy5yZWZyZXNoKCk7XG5cdFx0fVxuXHR9XG5cblx0dG9sYXN0UGFnZSgpIHtcblx0XHRpZih0aGlzLl9sYXN0RWxlbWVudC5vZmZzZXRMZWZ0K3RoaXMuX3Bvc2l0aW9uID4gdGhpcy5fY29udGFpbmVyV2lkdGgrdGhpcy5nZXRNYXJnaW5YKCkpIHtcblx0XHRcdHRoaXMuX3Bvc2l0aW9uID0gdGhpcy5fY29udGFpbmVyV2lkdGgrdGhpcy5nZXRNYXJnaW5YKCktdGhpcy5fbGFzdEVsZW1lbnQub2Zmc2V0TGVmdDtcblx0XHRcdHRoaXMuX3RleHQuc3R5bGUubGVmdCA9IHRoaXMuX3Bvc2l0aW9uK1wicHhcIjtcblx0XHRcdHRoaXMucmVmcmVzaCgpO1xuXHRcdH1cblx0fVxuXHRcblx0Z2V0UGFnZVN0YXJ0KCkge1xuXHRcdGxldCBpbmRleCwgc3RhcnRJbmRleDtcblx0XHRmb3IobGV0IGk9MDsgaTwgdGhpcy5fc2VjdGlvbnMubGVuZ3RoLTE7IGkrKykge1xuXHRcdFx0aWYodGhpcy5fc2VjdGlvbnNbaV0uY2xhc3NOYW1lLm1hdGNoKC93Yi1uby1wYWdlLykpIHtcblx0XHRcdFx0aW5kZXggPSBpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYoaW5kZXghPT11bmRlZmluZWQgJiYgc3RhcnRJbmRleD09PXVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdHN0YXJ0SW5kZXggPSBpO1xuXHRcdFx0XHRcdGxldCBlbCA9IHRoaXMuX3NlY3Rpb25zW3N0YXJ0SW5kZXhdO1xuXHRcdFx0XHRcdGxldCBlbFBvc2l0aW9uID0gZWwub2Zmc2V0TGVmdCAtIHRoaXMuZ2V0TWFyZ2luWCgpO1xuXHRcdFx0XHRcdGVsUG9zaXRpb24gPSAoZWxQb3NpdGlvbiV0aGlzLl9jb250YWluZXJXaWR0aCE9PTAgPyBlbFBvc2l0aW9uLWVsUG9zaXRpb24ldGhpcy5fY29udGFpbmVyV2lkdGggOiBlbFBvc2l0aW9uKTsvL2Fsd2F5cyBhdCBhIHBhZ2UgYmVnaW5uaW5nXG5cdFx0XHRcdFx0dGhpcy5fc3RhcnRQYWdlID0gZWxQb3NpdGlvbi90aGlzLl9jb250YWluZXJXaWR0aDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGdldFBhZ2VOdW1iZXIoKSB7XG5cdFx0Ly90aGlzLl9wb3NpdGlvbi90aGlzLl9jb250YWluZXJXaWR0aCBpcyBzdGFydCBvZiBhIHBhZ2UgOiBzdGFydCAwIGlzIHBhZ2UgMSwuLi4gKHNvIDogKzEpXG5cdFx0bGV0IHBhZ2VOdW1iZXIgPSBNYXRoLmFicyhNYXRoLmZsb29yKHRoaXMuX3Bvc2l0aW9uL3RoaXMuX2NvbnRhaW5lcldpZHRoKSkrMTtcblx0XHQvL3RoaXMuX3N0YXJ0UGFnZSAocGFnaW5hdGlvbiBzdGFydClcblx0XHRwYWdlTnVtYmVyID0gcGFnZU51bWJlci0odGhpcy5fc3RhcnRQYWdlKTtcblx0XHRyZXR1cm4gcGFnZU51bWJlcjtcblx0fVxuXG5cdGdldFRvdGFsUGFnZXMoKSB7XG5cdFx0bGV0IHRvdGFsUGFnZXMgPSBNYXRoLmZsb29yKHRoaXMuX2xhc3RFbGVtZW50Lm9mZnNldExlZnQvdGhpcy5fY29udGFpbmVyV2lkdGgpO1xuXHRcdHRvdGFsUGFnZXMgPSB0b3RhbFBhZ2VzLSh0aGlzLl9zdGFydFBhZ2UpO1xuXHRcdHJldHVybiB0b3RhbFBhZ2VzO1xuXHR9XG5cblx0Z29Ub1BhZ2UobnVtYmVyKSB7XG5cdFx0bnVtYmVyID0gKG51bWJlcjwxLSh0aGlzLl9zdGFydFBhZ2UpID8gMS0odGhpcy5fc3RhcnRQYWdlKSA6IG51bWJlcik7XG5cdFx0bnVtYmVyPSAobnVtYmVyPnRoaXMuZ2V0VG90YWxQYWdlcygpID8gdGhpcy5nZXRUb3RhbFBhZ2VzKCkgOiBudW1iZXIpO1xuXHRcdG51bWJlciA9IG51bWJlciArICh0aGlzLl9zdGFydFBhZ2UpO1xuXHRcdGxldCBwb3NpdGlvbiA9IHRoaXMuX2NvbnRhaW5lcldpZHRoKihudW1iZXItMSk7XG5cdFx0dGhpcy5fdGV4dC5zdHlsZS5sZWZ0ID0gLXBvc2l0aW9uICsgXCJweFwiO1xuXHRcdHRoaXMuX3Bvc2l0aW9uID0gdGhpcy5fdGV4dC5vZmZzZXRMZWZ0O1xuXHRcdHRoaXMucmVmcmVzaCgpO1xuXHR9XG5cblx0ZWxlbWVudFBhZ2VOdW1iZXIoaWQpIHtcblx0XHRsZXQgZWwgPSB0aGlzLl90ZXh0LnF1ZXJ5U2VsZWN0b3IoJyMnICsgaWQpO1xuXHRcdGxldCBlbFBvc2l0aW9uID0gZWwub2Zmc2V0TGVmdCAtIHRoaXMuZ2V0TWFyZ2luWCgpO1xuXHRcdGVsUG9zaXRpb24gPSAoZWxQb3NpdGlvbiV0aGlzLl9jb250YWluZXJXaWR0aCE9PTAgPyBlbFBvc2l0aW9uLWVsUG9zaXRpb24ldGhpcy5fY29udGFpbmVyV2lkdGggOiBlbFBvc2l0aW9uKTsvL2Fsd2F5cyBhdCBhIHBhZ2UgYmVnaW5uaW5nXG5cdFx0bGV0IGVsUGFnZU51bWJlciA9IGVsUG9zaXRpb24vdGhpcy5fY29udGFpbmVyV2lkdGggKyAxOy8vZWxQb3NpdGlvbi90aGlzLl9jb250YWluZXJXaWR0aCBpcyBwb3NpdGlvbiBvZiBhIHBhZ2UgOiBwb3NpdGlvbiAwIGlzIHBhZ2UgMSwuLi5cblx0XHRlbFBhZ2VOdW1iZXIgPSBlbFBhZ2VOdW1iZXItKHRoaXMuX3N0YXJ0UGFnZSk7XG5cdFx0cmV0dXJuIGVsUGFnZU51bWJlcjtcblx0fVxuXG5cdGdldFNlY3Rpb25UaXRsZSgpIHtcblx0XHRsZXQgcG9zaXRpb24gPSAtdGhpcy5fcG9zaXRpb247XG5cdFx0bGV0IHRpdGxlO1xuXHRcdGZvcihsZXQgaT0xOyBpPHRoaXMuX3NlY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRpZih0aGlzLl9zZWN0aW9uc1tpXS5vZmZzZXRMZWZ0LXRoaXMuX2NvbnRhaW5lcldpZHRoPj1wb3NpdGlvbikge1xuXHRcdFx0XHRsZXQgaWQgPSB0aGlzLl9zZWN0aW9uc1tpLTFdLmlkO1xuXHRcdFx0XHRpZihpZCE9PXVuZGVmaW5lZCAmJiB0aGlzLmdldFBhZ2VOdW1iZXIoKSA9PT0gdGhpcy5lbGVtZW50UGFnZU51bWJlcihpZCkpIHtcblx0XHRcdFx0XHR0aXRsZSA9IFwiXCI7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGl0bGUgPSB0aGlzLl9zZWN0aW9uc1tpLTFdLnRpdGxlO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGl0bGU7XG5cdH1cblx0XG5cdGdldFRvYygpIHtcblx0XHRpZighdGhpcy5fdG9jKSB7IHJldHVybjsgfVxuXHRcdGlmKHRoaXMuX3RvYy5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2ItdG9jJykpIHtcblx0XHRcdGxldCB0b2NUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0XHRcdHRvY1RpdGxlLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCd3Yi10b2MtdGl0bGUnKTtcblx0XHRcdHRvY1RpdGxlLmlubmVySFRNTCA9IHRoaXMuX3RvYy5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2ItdG9jJyk7XG5cdFx0XHR0aGlzLl90b2MuYXBwZW5kQ2hpbGQodG9jVGl0bGUpO1xuXHRcdH1cblx0XHRsZXQgbGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cdFx0bGlzdC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywnd2ItdG9jLWxpc3QnKTtcblx0XHR0aGlzLl9zZWN0aW9ucy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0aWYoIXZhbC5jbGFzc05hbWUubWF0Y2goL3diLW5vLXRvYy8pKSB7XG5cdFx0XHRcdGxldCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblx0XHRcdFx0aXRlbS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywnd2ItdG9jLWl0ZW0nKTtcblx0XHRcdFx0bGV0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG5cdFx0XHRcdGxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgJyMnICsgdmFsLmlkKTtcblx0XHRcdFx0bGluay5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3diLWxpbmsnKTtcblx0XHRcdFx0bGV0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuXHRcdFx0XHR0aXRsZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywnd2ItdG9jLWl0ZW0tdGl0bGUnKTtcblx0XHRcdFx0dGl0bGUuaW5uZXJIVE1MID0gdmFsLnRpdGxlO1xuXHRcdFx0XHRsZXQgcGFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcblx0XHRcdFx0dGl0bGUuc2V0QXR0cmlidXRlKCdjbGFzcycsJ3diLXRvYy1pdGVtLXBhZ2UtbnVtYmVyJyk7XG5cdFx0XHRcdHBhZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXdiLWVsZW1lbnQtcGFnZS1udW1iZXInLCB2YWwuaWQpO1xuXHRcdFx0XHRsaW5rLmFwcGVuZENoaWxkKHRpdGxlKTtcblx0XHRcdFx0bGluay5hcHBlbmRDaGlsZChwYWdlKTtcblx0XHRcdFx0aXRlbS5hcHBlbmRDaGlsZChsaW5rKTtcblx0XHRcdFx0bGlzdC5hcHBlbmRDaGlsZChpdGVtKTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHR0aGlzLl90b2MuYXBwZW5kQ2hpbGQobGlzdCk7XG5cdH1cblx0XG5cdGdldFRvY0N1cnJlbnRTZWN0aW9uKCkge1xuXHRcdGxldCBwb3NpdGlvbiA9IC10aGlzLl9wb3NpdGlvbjtcblx0XHRmb3IobGV0IGk9MTsgaTx0aGlzLl9zZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuXHRcdFx0aWYodGhpcy5fc2VjdGlvbnNbaV0ub2Zmc2V0TGVmdC10aGlzLl9jb250YWluZXJXaWR0aD49cG9zaXRpb24pIHtcblx0XHRcdFx0bGV0IGlkID0gdGhpcy5fc2VjdGlvbnNbaS0xXS5pZDtcblx0XHRcdFx0dGhpcy5fdG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EnKS5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0XHRcdGlmKHZhbC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKS5yZXBsYWNlKC9eIy8sJycpID09PSBpZCkge1xuXHRcdFx0XHRcdFx0aWYoIXZhbC5wYXJlbnRFbGVtZW50LmNsYXNzTmFtZS5tYXRjaCgvY3VycmVudC8pKSB7XG5cdFx0XHRcdFx0XHRcdHZhbC5wYXJlbnRFbGVtZW50LmNsYXNzTmFtZSs9JyBjdXJyZW50Jztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aWYodmFsLnBhcmVudEVsZW1lbnQuY2xhc3NOYW1lLm1hdGNoKC9jdXJyZW50LykpIHtcblx0XHRcdFx0XHRcdFx0dmFsLnBhcmVudEVsZW1lbnQuY2xhc3NOYW1lPXZhbC5wYXJlbnRFbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKC8gY3VycmVudC8sJycpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGluc2VydEJvb2ttYXJrKCkge1xuXHRcdGxldCBib29rbWFyayA9IG51bGw7XG5cdFx0Zm9yKGxldCBpPTA7IGk8dGhpcy5fZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdGxldCBlbFBvc2l0aW9uID0gdGhpcy5fZWxlbWVudHNbaV0ub2Zmc2V0TGVmdC10aGlzLmdldE1hcmdpblgoKTtcblx0XHRcdGVsUG9zaXRpb24gPSAoZWxQb3NpdGlvbiV0aGlzLl9jb250YWluZXJXaWR0aCE9PTAgPyBlbFBvc2l0aW9uLWVsUG9zaXRpb24ldGhpcy5fY29udGFpbmVyV2lkdGggOiBlbFBvc2l0aW9uKTsvL2Fsd2F5cyBhdCBhIHBhZ2UgYmVnaW5uaW5nXG5cdFx0XHRpZihlbFBvc2l0aW9uID09PSAtdGhpcy5fcG9zaXRpb24pXG5cdFx0XHR7XG5cdFx0XHRcdGJvb2ttYXJrID0gaTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIGlmKGVsUG9zaXRpb24gPiAtdGhpcy5fcG9zaXRpb24pXG5cdFx0XHR7XG5cdFx0XHRcdGJvb2ttYXJrID0gaS0xO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cdFx0dGhpcy5fYm9va21hcmsgPSBib29rbWFyaztcblx0fVxuXG5cdGdvVG9Cb29rbWFyayhib29rbWFyaykge1xuXHRcdGxldCBlbGVtZW50ID0gdGhpcy5fZWxlbWVudHNbdGhpcy5fYm9va21hcmtdO1xuXHRcdC8vcG9zaXRpb24gOiBvZmZzZXRMZWZ0IG9mIGVsZW1lbnQgcmVsYXRpdmUgdG8gdGV4dFxuXHRcdGxldCBwb3NpdGlvbiA9IGVsZW1lbnQub2Zmc2V0TGVmdC10aGlzLmdldE1hcmdpblgoKTtcblx0XHRwb3NpdGlvbiA9IChwb3NpdGlvbiV0aGlzLl9jb250YWluZXJXaWR0aCE9PTAgPyBwb3NpdGlvbi1wb3NpdGlvbiV0aGlzLl9jb250YWluZXJXaWR0aCA6IHBvc2l0aW9uKTsvL2Fsd2F5cyBhdCBhIHBhZ2UgYmVnaW5uaW5nXG5cdFx0Ly90ZXh0IHBvc2l0aW9uID0gLXBvc2l0aW9uXG5cdFx0dGhpcy5fdGV4dC5zdHlsZS5sZWZ0ID0gLXBvc2l0aW9uICsgXCJweFwiO1xuXHRcdHRoaXMuX3Bvc2l0aW9uID0gdGhpcy5fdGV4dC5vZmZzZXRMZWZ0O1xuXHRcdHRoaXMucmVmcmVzaCgpO1xuXHR9XG5cblx0cmVmcmVzaCgpIHtcblx0XHR0aGlzLmluc2VydEJvb2ttYXJrKCk7XG5cblx0XHRpZih0aGlzLmNvbD09PWZhbHNlKSB7XG5cdFx0XHRcblx0XHRcdHRoaXMuX2N1cnJlbnRQYWdlcy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0XHR2YWwuaW5uZXJIVE1MID0gXCJcIjtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLl90b3RhbFBhZ2VzLmZvckVhY2goIHZhbCA9PiB7XG5cdFx0XHRcdHZhbC5pbm5lckhUTUwgPSBcIlwiO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuX2N1cnJlbnRUb3RhbFBhZ2VzLmZvckVhY2goIHZhbCA9PiB7XG5cdFx0XHRcdHZhbC5pbm5lckhUTUwgPSBcIlwiO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRoaXMuX2VsUGFnZU51bWJlcnMuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdFx0dmFsLmlubmVySFRNTCA9IFwiXCI7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5fc2VjdGlvblRpdGxlcy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0XHR2YWwuaW5uZXJIVE1MID0gXCJcIjtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0fSBlbHNlIHtcblx0XHRcdFxuXHRcdFx0dGhpcy5nZXRQYWdlU3RhcnQoKTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy5fdG9jKSB7XG5cdFx0XHRcdHRoaXMuZ2V0VG9jQ3VycmVudFNlY3Rpb24oKTtcblx0XHRcdH1cdFxuXHRcdFx0XG5cdFx0XHR0aGlzLl9jdXJyZW50UGFnZXMuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdFx0aWYodmFsLmlubmVySFRNTCE9dGhpcy5nZXRQYWdlTnVtYmVyKCkpIHtcblx0XHRcdFx0XHR2YWwuaW5uZXJIVE1MID0gdGhpcy5nZXRQYWdlTnVtYmVyKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLl90b3RhbFBhZ2VzLmZvckVhY2goIHZhbCA9PiB7XG5cdFx0XHRcdGlmKHZhbC5pbm5lckhUTUwhPXRoaXMuZ2V0VG90YWxQYWdlcygpKSB7XG5cdFx0XHRcdFx0dmFsLmlubmVySFRNTCA9IHRoaXMuZ2V0VG90YWxQYWdlcygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5fY3VycmVudFRvdGFsUGFnZXMuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdFx0aWYodGhpcy5nZXRQYWdlTnVtYmVyKCkgPCAxKSB7XG5cdFx0XHRcdFx0dmFsLmlubmVySFRNTCA9IFwiJmVtc3A7JmVtc3A7XCI7XG5cdFx0XHRcdH0gZWxzZSBpZih2YWwuaW5uZXJIVE1MIT09IHRoaXMuZ2V0UGFnZU51bWJlcigpICsgXCIvXCIgKyB0aGlzLmdldFRvdGFsUGFnZXMoKSkge1xuXHRcdFx0XHRcdHZhbC5pbm5lckhUTUwgPSB0aGlzLmdldFBhZ2VOdW1iZXIoKSArIFwiL1wiICsgdGhpcy5nZXRUb3RhbFBhZ2VzKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLl9lbFBhZ2VOdW1iZXJzLmZvckVhY2goIHZhbCA9PiB7XG5cdFx0XHRcdGxldCBpZCA9IHZhbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2ItZWxlbWVudC1wYWdlLW51bWJlcicpO1xuXHRcdFx0XHRsZXQgcGFnZU51bWJlciA9IHRoaXMuZWxlbWVudFBhZ2VOdW1iZXIoaWQpO1xuXHRcdFx0XHRpZihwYWdlTnVtYmVyIDwgMSkge1xuXHRcdFx0XHRcdHZhbC5pbm5lckhUTUwgPSBcIlwiO1xuXHRcdFx0XHR9IGVsc2UgaWYodmFsLmlubmVySFRNTCE9cGFnZU51bWJlcikge1xuXHRcdFx0XHRcdHZhbC5pbm5lckhUTUwgPSBwYWdlTnVtYmVyO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0dGhpcy5fc2VjdGlvblRpdGxlcy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0XHRpZih2YWwuaW5uZXJIVE1MIT09dGhpcy5nZXRTZWN0aW9uVGl0bGUoKSkge1xuXHRcdFx0XHRcdHZhbC5pbm5lckhUTUwgPSB0aGlzLmdldFNlY3Rpb25UaXRsZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdH1cblx0fVxufVxuXG4iXX0=
